# Milestone v1.2: Community Collections

**Status:** SHIPPED 2026-02-19
**Phases:** 13-17
**Total Plans:** 15

## Overview

v1.2 Community Collections transformed the single federal question bank into a multi-collection system where players choose community-specific trivia. The critical path was the JSON-to-PostgreSQL migration (Phase 13), which unblocked every downstream feature. Players can now choose from Federal, Bloomington IN, and Los Angeles CA collections with 320 total playable questions.

## Phases

### Phase 13: Database Schema & Seed Migration

**Goal**: Questions and collections live in PostgreSQL, with the existing 120-question federal bank migrated and tagged
**Depends on**: Nothing (v1.2 starting point)
**Requirements**: COLL-01, COLL-02, COLL-03, COLL-04, COLL-05, CCONT-01
**Plans**: 3 plans

Plans:
- [x] 13-01-PLAN.md — Drizzle ORM setup, schema definitions, SQL migration, rollback script
- [x] 13-02-PLAN.md — Research authoritative sources for 87 unsourced questions
- [x] 13-03-PLAN.md — Seed collections, topics, and migrate 120 questions into PostgreSQL

**Result:** Database seeded with 3 collections, 15 topics, and 120 migrated federal civics questions with authoritative sources.

### Phase 14: Question Service & Route Integration

**Goal**: The game queries PostgreSQL instead of JSON, with collection-scoped question loading and zero regression
**Depends on**: Phase 13
**Requirements**: CGFLOW-03, CGFLOW-04, CGFLOW-05
**Plans**: 2 plans

Plans:
- [x] 14-01-PLAN.md — QuestionService module with difficulty-balanced selection, recent exclusion, and JSON fallback
- [x] 14-02-PLAN.md — Wire QuestionService into game routes, update frontend for collection metadata

**Result:** Game routes use PostgreSQL-sourced questions via QuestionService with collection scoping and recent-question tracking.

### Phase 15: Collection Picker UI

**Goal**: Players can browse and select a collection before starting a game
**Depends on**: Phase 14
**Requirements**: CGFLOW-01, CGFLOW-02
**Plans**: 3 plans

Plans:
- [x] 15-01-PLAN.md — Backend GET /api/game/collections endpoint with question counts
- [x] 15-02-PLAN.md — Collection picker components (types, hook, card, skeleton, picker)
- [x] 15-03-PLAN.md — Dashboard integration, game flow wiring, collection name display

**Result:** Complete end-to-end collection picker flow with Dashboard selection, router state passing, and collection name displayed during play and on results screen.

### Phase 16: Expiration System

**Goal**: Time-sensitive questions automatically drop from rotation without disrupting active games
**Depends on**: Phase 14
**Requirements**: EXP-01, EXP-02, EXP-03, EXP-04, ADM-01
**Plans**: 3 plans

Plans:
- [x] 16-01-PLAN.md — Schema migration (status + audit history fields), node-cron install, hourly expiration sweep
- [x] 16-02-PLAN.md — Collection health endpoint and admin API routes (renew, archive)
- [x] 16-03-PLAN.md — Admin review page with filter tabs, question list, and action buttons

**Result:** Protected admin review page with filter tabs and action buttons for content reviewers, enabling question status management and renewal workflows.

### Phase 17: Community Content Generation

**Goal**: Players can choose Bloomington IN or Los Angeles CA collections with locally relevant civic trivia
**Depends on**: Phase 13 (database ready), Phase 15 (picker available)
**Requirements**: CCONT-02, CCONT-03, CCONT-04, CCONT-05
**Plans**: 4 plans

Plans:
- [x] 17-01-PLAN.md — Content generation tooling infrastructure (Anthropic client, Zod schema, locale configs, RAG fetcher, seeder)
- [x] 17-02-PLAN.md — Bloomington IN source curation and ~100 question generation with human review
- [x] 17-03-PLAN.md — Los Angeles CA source curation and ~100 question generation with human review
- [x] 17-04-PLAN.md — Activate both collections and end-to-end playability verification

**Result:** Both Bloomington IN and Los Angeles CA collections activated with 100 questions each, delivering 320 total playable questions across 3 collections.

---

## Milestone Summary

**Key Decisions:**
- Tag-based collections over rigid categories (questions can belong to multiple collections)
- AI-generated + human-reviewed content (AI kickstarts local question banks, volunteers refine)
- Quality over quantity for local sets (50 compelling > 100 half-compelling)
- Auto-remove + notify on expiration (time-sensitive questions drop and flag for review)
- Database as single source of truth (questions.json remains as historical reference only)
- externalId as Question.id for backward compat with existing session/answer logic
- status='draft' for AI-generated questions (admin reviews before activation)
- Zod parse over tool_use for AI response validation (simpler than tool_use approach)

**Issues Resolved:**
- Phase 16 gap (missing status filter in GET /collections) fixed during Phase 17
- LA RAG source fetch failures (7/14) — proceeded with partial sources, sufficient coverage
- Community topic icons not mapped — graceful degradation via guard check

**Issues Deferred:**
- Module-level recentQuestions Map lost on restart (acceptable for single-instance)
- Health endpoint has no frontend consumer (monitoring-only by design)
- TOPIC_ICONS missing for community categories (graceful degradation, cosmetic only)

**Technical Debt Incurred:**
- recentQuestions tracking needs Redis persistence for multi-instance deployments
- Phase 16 VERIFICATION.md still shows stale gaps_found status (code is correct)
- 17-04-SUMMARY.md describes BarChart2 fallback but code uses guard check (docs inaccuracy)

---

_For current project status, see .planning/PROJECT.md_
