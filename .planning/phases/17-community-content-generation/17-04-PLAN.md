---
phase: 17-community-content-generation
plan: 04
type: execute
wave: 4
depends_on: ["17-02", "17-03"]
files_modified:
  - backend/src/db/seed/collections.ts
autonomous: false

must_haves:
  truths:
    - "Bloomington IN collection appears in the collection picker with accurate question count"
    - "Los Angeles CA collection appears in the collection picker with accurate question count"
    - "Player can select Bloomington, play a full 10-question game, and see results"
    - "Player can select LA, play a full 10-question game, and see results"
    - "Collection cards show correct names, descriptions, and active question counts"
  artifacts:
    - path: "database: civic_trivia.collections WHERE slug IN ('bloomington-in', 'los-angeles-ca')"
      provides: "Both collections with is_active=true and status='active' questions"
    - path: "database: civic_trivia.questions WHERE status='active' AND external_id LIKE 'bli-%'"
      provides: "Activated Bloomington questions ready for gameplay"
    - path: "database: civic_trivia.questions WHERE status='active' AND external_id LIKE 'lac-%'"
      provides: "Activated LA questions ready for gameplay"
  key_links:
    - from: "GET /api/game/collections"
      to: "civic_trivia.collections WHERE is_active=true"
      via: "collections endpoint filters by is_active"
      pattern: "isActive.*true"
    - from: "POST /api/game/start with collectionId"
      to: "civic_trivia.questions WHERE status='active'"
      via: "QuestionService filters by collection + status"
      pattern: "status.*active"
---

<objective>
Activate both community collections and verify end-to-end playability through the collection picker.

Purpose: Transitions Bloomington and LA from draft to live, making them playable in the game. This is the final step that delivers the phase goal.
Output: Both collections are active, questions are playable, and the full player flow works end-to-end.
</objective>

<execution_context>
@C:\Users\Chris\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Chris\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-community-content-generation/17-02-SUMMARY.md
@.planning/phases/17-community-content-generation/17-03-SUMMARY.md
@backend/src/db/schema.ts
@backend/src/db/seed/collections.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Activate collections and questions</name>
  <files>
    backend/src/db/seed/collections.ts
  </files>
  <action>
    1. Update `backend/src/db/seed/collections.ts` to set isActive: true for both Bloomington and LA collections (so future re-seeds also activate them).

    2. Activate collections in the live database:
       ```sql
       UPDATE civic_trivia.collections SET is_active = true, updated_at = NOW() WHERE slug IN ('bloomington-in', 'los-angeles-ca');
       ```

    3. Activate all draft questions for both locales:
       ```sql
       UPDATE civic_trivia.questions SET status = 'active', updated_at = NOW() WHERE external_id LIKE 'bli-%' AND status = 'draft';
       UPDATE civic_trivia.questions SET status = 'active', updated_at = NOW() WHERE external_id LIKE 'lac-%' AND status = 'draft';
       ```

    4. Verify activation:
       ```sql
       SELECT c.name, c.is_active, COUNT(q.id) as active_questions
       FROM civic_trivia.collections c
       LEFT JOIN civic_trivia.collection_questions cq ON c.id = cq.collection_id
       LEFT JOIN civic_trivia.questions q ON cq.question_id = q.id AND q.status = 'active'
       GROUP BY c.id, c.name, c.is_active
       ORDER BY c.sort_order;
       ```
       Should show 3 active collections: Federal (~120), Bloomington (~100), LA (~100).

    5. Test the collections API endpoint:
       ```bash
       curl http://localhost:3001/api/game/collections
       ```
       Should return all 3 collections with question counts.
  </action>
  <verify>
    Collections API returns 3 active collections with non-zero question counts. Database queries confirm is_active=true for bloomington-in and los-angeles-ca, and status='active' for all bli-* and lac-* questions.
  </verify>
  <done>Both community collections are active in the database with all questions set to active status. Collections API returns all 3 playable collections.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Both Bloomington IN and Los Angeles CA collections activated with ~100 questions each. Collections visible in picker alongside Federal Civics. Full game flow works end-to-end.</what-built>
  <how-to-verify>
    1. Start the dev server: `cd backend && npm run dev` (if not running)
    2. Start the frontend: `cd frontend && npm run dev` (if not running)
    3. Open the app in browser (http://localhost:5173 or deployed URL)
    4. Verify collection picker shows 3 collections: Federal Civics, Bloomington IN, Los Angeles CA
    5. Check each collection card shows name, description, and question count
    6. Select Bloomington IN and start a game:
       - Verify 10 questions load about Bloomington/Indiana topics
       - Play through at least 3 questions to verify format, difficulty, explanations
       - Check that explanations cite sources with "According to..." pattern
       - Complete the game and verify results screen works
    7. Select Los Angeles CA and start a game:
       - Verify 10 questions load about LA/California topics
       - Play through at least 3 questions
       - Complete the game and verify results screen works
    8. Verify Federal Civics still works (no regression)
  </how-to-verify>
  <resume-signal>Type "approved" if all 3 collections are playable end-to-end, or describe issues</resume-signal>
</task>

</tasks>

<verification>
1. GET /api/game/collections returns 3 active collections with question counts
2. Starting a game with Bloomington collection loads Bloomington questions
3. Starting a game with LA collection loads LA questions
4. Federal Civics still works (no regression)
5. Results screen displays correctly for all collections
6. Collection picker shows accurate question counts for all 3
</verification>

<success_criteria>
- All 3 collections visible in the picker with accurate question counts
- Bloomington IN is fully playable end-to-end (select -> play 10 questions -> results)
- Los Angeles CA is fully playable end-to-end
- Federal Civics has zero regression
- Human verified all 3 collections work
</success_criteria>

<output>
After completion, create `.planning/phases/17-community-content-generation/17-04-SUMMARY.md`
</output>
