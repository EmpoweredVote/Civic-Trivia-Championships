---
phase: 04-learning-content
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - frontend/src/features/game/components/LearnMoreButton.tsx
  - frontend/src/features/game/components/LearnMoreTooltip.tsx
  - frontend/src/features/game/components/LearnMoreModal.tsx
  - frontend/src/features/game/components/AnswerGrid.tsx
  - frontend/src/features/game/components/GameScreen.tsx
  - frontend/src/features/game/hooks/useGameState.ts
  - frontend/src/features/game/gameReducer.ts
autonomous: true

must_haves:
  truths:
    - "Answer reveal shows 'Learn More' button when learningContent exists for that question"
    - "Button fades in after answer reveal settles"
    - "Tooltip auto-shows with first sentence teaser for 2.5 seconds, then dismisses"
    - "Tapping button opens centered card modal with full educational content"
    - "Modal shows answer-aware opener (correct/wrong/timeout) plus 2-3 paragraphs plus source citation"
    - "Opening modal pauses the 6-second auto-advance timer"
    - "Closing modal resumes auto-advance timer where it left off (not reset)"
    - "Game behind modal is visually dimmed"
    - "Escape key closes modal"
    - "Click outside modal closes modal"
    - "Keyboard shortcut 'L' opens modal during reveal phase"
    - "Tooltip only auto-shows once per game session"
  artifacts:
    - path: "frontend/src/features/game/components/LearnMoreButton.tsx"
      provides: "Styled button with fade-in animation"
      min_lines: 20
    - path: "frontend/src/features/game/components/LearnMoreTooltip.tsx"
      provides: "Auto-dismiss tooltip with teaser text"
      min_lines: 30
    - path: "frontend/src/features/game/components/LearnMoreModal.tsx"
      provides: "Headless UI Dialog with Framer Motion, answer-aware content"
      min_lines: 60
    - path: "frontend/src/features/game/components/GameScreen.tsx"
      provides: "Modal state management, timer pause/resume integration"
      contains: "LearnMoreModal"
    - path: "frontend/src/features/game/hooks/useGameState.ts"
      provides: "Timer pause/resume for modal, hasShownTooltip tracking"
      contains: "pauseAutoAdvance"
  key_links:
    - from: "frontend/src/features/game/components/LearnMoreButton.tsx"
      to: "frontend/src/features/game/components/LearnMoreModal.tsx"
      via: "onClick opens modal"
      pattern: "onOpenModal|setIsLearnMoreOpen"
    - from: "frontend/src/features/game/components/GameScreen.tsx"
      to: "frontend/src/features/game/hooks/useGameState.ts"
      via: "pauseAutoAdvance/resumeAutoAdvance callbacks"
      pattern: "pauseAutoAdvance|resumeAutoAdvance"
    - from: "frontend/src/features/game/components/LearnMoreModal.tsx"
      to: "frontend/src/types/game.ts"
      via: "LearningContent type for content rendering"
      pattern: "LearningContent"
    - from: "frontend/src/features/game/components/AnswerGrid.tsx"
      to: "frontend/src/features/game/components/LearnMoreButton.tsx"
      via: "Button rendered in reveal section"
      pattern: "LearnMoreButton"
---

<objective>
Build the Learn More UI components (button, tooltip, modal) and wire them into the game flow with timer pause/resume.

Purpose: This is the core user-facing feature -- the two-step reveal (button -> tooltip teaser -> full modal) that lets players access deeper educational content without leaving the game. Timer pause/resume ensures users aren't penalized for exploring content.

Output: Three new components (LearnMoreButton, LearnMoreTooltip, LearnMoreModal), updated GameScreen with modal state and timer control, updated useGameState with pause/resume auto-advance.
</objective>

<execution_context>
@C:\Users\Chris\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Chris\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-learning-content/04-CONTEXT.md
@.planning/phases/04-learning-content/04-RESEARCH.md
@.planning/phases/04-learning-content/04-01-SUMMARY.md
@frontend/src/features/game/components/GameScreen.tsx
@frontend/src/features/game/components/AnswerGrid.tsx
@frontend/src/features/game/hooks/useGameState.ts
@frontend/src/features/game/gameReducer.ts
@frontend/src/types/game.ts
@frontend/src/features/game/hooks/useKeyPress.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create LearnMoreButton, LearnMoreTooltip, and LearnMoreModal components</name>
  <files>
    frontend/src/features/game/components/LearnMoreButton.tsx
    frontend/src/features/game/components/LearnMoreTooltip.tsx
    frontend/src/features/game/components/LearnMoreModal.tsx
  </files>
  <action>
1. Create `LearnMoreButton.tsx`:
   - Props: `{ onOpenModal: () => void; hasContent: boolean }`
   - Only renders when `hasContent` is true
   - Styled button in lower-right area: teal-600 bg, rounded, "Learn More" text with a small book/lightbulb icon
   - Uses Framer Motion `motion.button` with `initial={{ opacity: 0 }}` and `animate={{ opacity: 1 }}` with `transition={{ delay: 0.8 }}` (fades in after reveal settles)
   - onClick calls onOpenModal
   - Minimum 48px touch target (min-h-[48px] min-w-[48px])

2. Create `LearnMoreTooltip.tsx`:
   - Props: `{ teaserText: string; show: boolean; onDismiss: () => void; onReadMore: () => void }`
   - Renders above the LearnMoreButton (positioned absolute, bottom-full)
   - Auto-dismiss after 2.5 seconds via useEffect with setTimeout
   - Tap-anywhere-to-dismiss: useEffect adds document click listener (capture phase) when `show` is true
   - Click inside tooltip stopPropagation to prevent self-dismissal
   - Shows first sentence of teaserText (truncate with "...")
   - "Read more ->" link that calls onReadMore
   - Framer Motion AnimatePresence with fade+slide animation (opacity 0->1, y 10->0)
   - Styled: bg-slate-700, rounded-lg, shadow-xl, max-w-xs, text-sm text-white

3. Create `LearnMoreModal.tsx`:
   - Props: `{ isOpen: boolean; onClose: () => void; content: LearningContent; userAnswer: number | null; correctAnswer: number }`
   - Uses Headless UI `Dialog` + `DialogPanel` with `static` prop
   - Uses Framer Motion AnimatePresence wrapping the Dialog (only rendered when isOpen)
   - Backdrop: `motion.div` with `bg-black/70 backdrop-blur-sm` (dims game behind), fade in/out
   - DialogPanel: `motion.div` with spring animation (scale 0.95->1, opacity 0->1)
   - Content structure (NO header/title -- dive straight into content per CONTEXT.md):
     a. Topic icon from TopicIcon component (small, inline with topic label)
     b. Answer-aware opener paragraph:
        - If userAnswer === correctAnswer: "That's right!" + first paragraph
        - If userAnswer === null (timeout): "Time's up! Here's what you should know..." + first paragraph
        - If userAnswer is wrong: Show the specific correction from content.corrections[userAnswer.toString()] + first paragraph
     c. Remaining paragraphs from content.paragraphs (2nd and 3rd)
     d. Source citation at bottom: border-t separator, "Source: [link]" where link opens in new tab (target="_blank" rel="noopener noreferrer"), styled text-teal-400
   - Close button: absolute top-4 right-4, X icon (SVG), text-slate-400 hover:text-white, aria-label="Close"
   - Escape key closes (Headless UI Dialog handles this automatically)
   - Click outside closes (Headless UI Dialog onClose handles this automatically)
   - Scrollable content: max-h-[80vh] overflow-y-auto on DialogPanel
   - Modal max-w-2xl, centered, bg-slate-800 rounded-lg p-6
   - Import TopicIcon and TOPIC_ICONS, TOPIC_LABELS from TopicIcon.tsx
   - Import LearningContent from types/game.ts
  </action>
  <verify>
    - `cd frontend && npx tsc --noEmit` passes
    - All three files exist with correct imports
    - LearnMoreModal imports from @headlessui/react (Dialog, DialogPanel)
    - LearnMoreModal imports from framer-motion (AnimatePresence, motion)
  </verify>
  <done>
    - LearnMoreButton renders with fade-in animation
    - LearnMoreTooltip auto-shows and auto-dismisses after 2.5s
    - LearnMoreModal uses Headless UI Dialog with Framer Motion, shows answer-aware content, has close button, escape key, click-outside
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire Learn More into GameScreen with timer pause/resume and keyboard shortcut</name>
  <files>
    frontend/src/features/game/components/AnswerGrid.tsx
    frontend/src/features/game/components/GameScreen.tsx
    frontend/src/features/game/hooks/useGameState.ts
    frontend/src/features/game/gameReducer.ts
  </files>
  <action>
1. Update `useGameState.ts` to support auto-advance timer pause/resume:
   - Add a `autoAdvancePausedAtRef` ref (type: `number | null`) to store the remaining auto-advance time when paused
   - Add `pauseAutoAdvance()` function:
     - Calculates how much time remains on the auto-advance timer (AUTO_ADVANCE_MS - elapsed since reveal started)
     - Stores that value in autoAdvancePausedAtRef
     - Clears the autoAdvanceTimeoutRef timeout
   - Add `resumeAutoAdvance()` function:
     - Reads autoAdvancePausedAtRef for remaining time
     - Sets a new timeout for the remaining duration
     - Clears autoAdvancePausedAtRef
   - Track reveal start time: add `revealStartTimeRef` (type: `number | null`), set to `Date.now()` when entering 'revealing' phase
   - Update the auto-advance useEffect: set `revealStartTimeRef.current = Date.now()` when phase becomes 'revealing'
   - Expose `pauseAutoAdvance` and `resumeAutoAdvance` in the return object
   - Add `hasShownTooltip` state (useState<boolean>(false)) -- tracks whether tooltip has auto-shown this game session
   - Reset hasShownTooltip to false in startGame()
   - Expose `hasShownTooltip` and `setHasShownTooltip` in return object

2. Update `GameScreen.tsx`:
   - Add imports for LearnMoreButton, LearnMoreTooltip, LearnMoreModal, and LearningContent type
   - Receive `pauseAutoAdvance`, `resumeAutoAdvance`, `hasShownTooltip`, `setHasShownTooltip` from props (pass from Game.tsx through useGameState)
   - Add state: `isLearnMoreOpen` (boolean, false), `showTooltip` (boolean, false)
   - Determine if current question has learning content: `const learningContent = currentQuestion?.learningContent ?? null`
   - Determine latest answer for answer-aware opener: `const latestAnswer = state.answers[state.answers.length - 1]`
   - Handle tooltip auto-show logic:
     - useEffect: when phase becomes 'revealing' and learningContent exists and !hasShownTooltip:
       - After 1 second delay (let reveal settle), setShowTooltip(true) and setHasShownTooltip(true)
     - When showTooltip changes to false naturally (from tooltip auto-dismiss), no action needed
   - handleOpenLearnMore function:
     - setShowTooltip(false)
     - setIsLearnMoreOpen(true)
     - Call pauseAutoAdvance()
   - handleCloseLearnMore function:
     - setIsLearnMoreOpen(false)
     - Call resumeAutoAdvance()
   - Add 'L' keyboard shortcut using useKeyPress:
     - `useKeyPress('l', handleOpenLearnMore, state.phase === 'revealing' && !!learningContent && !isLearnMoreOpen)`
   - Render LearnMoreButton + LearnMoreTooltip in the reveal section of the layout (after the score popup area, positioned in lower-right):
     - Only render when `state.phase === 'revealing' && learningContent`
     - Pass teaserText as first sentence of learningContent.paragraphs[0] (split on '. ' and take first sentence + '.')
   - Render LearnMoreModal:
     - isOpen={isLearnMoreOpen}
     - onClose={handleCloseLearnMore}
     - content={learningContent}
     - userAnswer={latestAnswer?.selectedOption ?? null}
     - correctAnswer={latestAnswer?.correctAnswer ?? 0}

3. Update `GameScreen` props interface (GameScreenProps):
   - Add: pauseAutoAdvance: () => void
   - Add: resumeAutoAdvance: () => void
   - Add: hasShownTooltip: boolean
   - Add: setHasShownTooltip: (value: boolean) => void

4. Update `Game.tsx` (frontend/src/pages/Game.tsx):
   - Destructure pauseAutoAdvance, resumeAutoAdvance, hasShownTooltip, setHasShownTooltip from useGameState()
   - Pass them to GameScreen as props

5. Update `AnswerGrid.tsx`:
   - NO changes needed to AnswerGrid itself. The LearnMoreButton will be rendered by GameScreen in the reveal area below AnswerGrid (not inside it). This keeps AnswerGrid's concerns clean.

IMPORTANT: The auto-advance timer pause/resume must preserve exact remaining time. If the auto-advance was at 4.2s remaining when modal opened, it should resume with 4.2s remaining when modal closes. Do NOT reset to 6s.

IMPORTANT: Tooltip only auto-shows ONCE per game session (across all 10 questions). The hasShownTooltip flag persists across questions within a session. The button still appears on every reveal where content exists -- just the tooltip auto-show is once.

IMPORTANT: On mobile, first tap on LearnMoreButton while tooltip is visible should open the modal (not just dismiss tooltip). The button onClick handler dismisses tooltip AND opens modal.
  </action>
  <verify>
    - `cd frontend && npx tsc --noEmit` passes
    - GameScreen imports and renders LearnMoreButton, LearnMoreTooltip, LearnMoreModal
    - useGameState exports pauseAutoAdvance and resumeAutoAdvance
    - Game.tsx passes new props to GameScreen
    - useKeyPress('l', ...) is registered in GameScreen
  </verify>
  <done>
    - LearnMoreButton appears during reveal phase when learningContent exists
    - Tooltip auto-shows once per session with teaser text
    - Clicking button (or 'L' key) opens LearnMoreModal
    - Opening modal pauses auto-advance timer, closing resumes at saved position
    - Modal shows answer-aware content with topic icon, paragraphs, source citation
    - Escape/click-outside closes modal and resumes timer
  </done>
</task>

</tasks>

<verification>
- `cd frontend && npx tsc --noEmit` -- full type check passes
- GameScreen renders LearnMoreButton during reveal for questions with learningContent
- LearnMoreModal opens with Headless UI Dialog (accessible focus trap)
- Timer pause/resume preserves exact remaining time
- 'L' keyboard shortcut works during reveal phase
- Tooltip auto-shows once then stops for rest of session
</verification>

<success_criteria>
- Learn More button visible during answer reveal for questions with content
- Two-step reveal works: button appears -> tooltip auto-shows briefly -> user can open full modal
- Modal shows answer-aware opener, 2-3 educational paragraphs, topic icon, source citation
- Timer pauses on modal open, resumes on close (preserving exact time)
- Keyboard shortcut 'L' opens modal during reveal
- Modal is accessible: focus trap, escape key, click outside
- Tooltip only auto-shows once per game session
</success_criteria>

<output>
After completion, create `.planning/phases/04-learning-content/04-02-SUMMARY.md`
</output>
