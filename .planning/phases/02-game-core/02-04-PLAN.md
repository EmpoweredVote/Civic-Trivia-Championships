---
phase: 02-game-core
plan: 04
type: execute
wave: 4
depends_on: ["02-03"]
files_modified:
  - frontend/src/features/game/components/ResultsScreen.tsx
  - frontend/src/pages/Game.tsx
  - frontend/src/App.tsx
autonomous: false

must_haves:
  truths:
    - "Results screen shows final score as fraction (e.g., 7/10) with equal visual weight to accuracy"
    - "Results screen has expandable question-by-question review (collapsed by default)"
    - "Review shows each question's text, player's answer, correct answer, and explanation"
    - "Two action buttons: Play Again and Home"
    - "Game is accessible at /play route"
    - "Dashboard has a Play button that navigates to /play"
    - "Complete game flow works end-to-end: start -> 10 questions -> results -> play again or home"
  artifacts:
    - path: "frontend/src/features/game/components/ResultsScreen.tsx"
      provides: "Game results display with score, accuracy, and expandable review"
      exports: ["ResultsScreen"]
      min_lines: 80
    - path: "frontend/src/pages/Game.tsx"
      provides: "Game page component wrapping GameScreen and ResultsScreen"
      exports: ["Game"]
    - path: "frontend/src/App.tsx"
      provides: "Updated routing with /play route"
  key_links:
    - from: "frontend/src/pages/Game.tsx"
      to: "frontend/src/features/game/components/GameScreen.tsx"
      via: "Renders GameScreen when phase is not complete"
      pattern: "GameScreen"
    - from: "frontend/src/pages/Game.tsx"
      to: "frontend/src/features/game/components/ResultsScreen.tsx"
      via: "Renders ResultsScreen when phase is complete"
      pattern: "ResultsScreen"
    - from: "frontend/src/App.tsx"
      to: "frontend/src/pages/Game.tsx"
      via: "Route element at /play"
      pattern: "Route.*path.*play"
    - from: "frontend/src/pages/Dashboard.tsx"
      to: "/play"
      via: "Navigation link or button"
      pattern: "navigate.*play|Link.*play"
---

<objective>
Build the results screen, create the Game page that orchestrates game screen and results, wire up routing in App.tsx, and add a play button to the Dashboard. This completes the full end-to-end game flow and makes it accessible to users.

Purpose: Without routing and the results screen, the game has no entry point and no conclusion. This plan completes the loop: Dashboard -> Start Game -> Play 10 Questions -> See Results -> Play Again or Go Home.
Output: ResultsScreen component, Game page, updated App.tsx routing, human verification of full flow.
</objective>

<execution_context>
@C:\Users\Chris\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Chris\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-game-core/02-CONTEXT.md
@.planning/phases/02-game-core/02-RESEARCH.md
@.planning/phases/02-game-core/02-03-SUMMARY.md
@frontend/src/App.tsx
@frontend/src/pages/Dashboard.tsx
@frontend/src/features/game/components/GameScreen.tsx
@frontend/src/features/game/hooks/useGameState.ts
@frontend/src/types/game.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ResultsScreen component</name>
  <files>
    frontend/src/features/game/components/ResultsScreen.tsx
  </files>
  <action>
    Create `frontend/src/features/game/components/ResultsScreen.tsx`:

    **Props:** `result: GameResult`, `questions: Question[]`, `onPlayAgain: () => void`, `onHome: () => void`

    **Layout (Millionaire aesthetic, dark background matching GameScreen):**
    - Centered content, max-width container
    - Same dark background as game screen for visual consistency

    **Score display (balanced, equal visual weight):**
    - Score shown as fraction: "7/10" in large text
    - Label below: "Questions Correct"
    - Accuracy percentage next to or below score: "70%" (derived from fraction)
    - Both score and accuracy should have equal visual prominence — side by side or stacked with same font size
    - Use Framer Motion for a subtle entrance animation (fade-in with slight scale, 0.3s delay stagger)
    - NO performance-tiered messages — same visual treatment regardless of score (per CONTEXT.md)

    **Question-by-question review:**
    - "Review Answers" button, collapsed by default
    - When expanded, shows scrollable list of all 10 questions:
      - Question number and text
      - Player's answer (highlighted red if wrong, green if correct)
      - Correct answer (always highlighted green)
      - Explanation text (1-3 sentences)
      - If player timed out: show "No answer (timed out)" instead of player's answer
    - Use a simple toggle state for expand/collapse
    - Framer Motion AnimatePresence for smooth expand/collapse animation

    **Action buttons:**
    - "Play Again" button: teal/primary, calls onPlayAgain
    - "Home" button: secondary/outline style, calls onHome
    - Centered below score display, side by side with gap
    - Adequate touch targets (min 48px height)

    **No time stats** on results screen (per CONTEXT.md decision).
  </action>
  <verify>
    Run `cd frontend && npx tsc --noEmit` to verify component compiles.
    Check that it imports GameResult and Question types correctly.
    Check that Framer Motion animations are used for entrance and review toggle.
  </verify>
  <done>
    ResultsScreen shows score as fraction with equal-weight accuracy display, expandable question review (collapsed by default), and Play Again / Home action buttons. No performance-tiered messaging. Matches dark Millionaire aesthetic.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Game page and wire routing</name>
  <files>
    frontend/src/pages/Game.tsx
    frontend/src/App.tsx
    frontend/src/pages/Dashboard.tsx
  </files>
  <action>
    1. **Create `frontend/src/pages/Game.tsx`:**
       - This is the page-level component that manages the game lifecycle
       - Calls `useGameState()` hook
       - Conditionally renders:
         - If `state.phase === 'complete'`: render `<ResultsScreen>` with result data, questions, onPlayAgain (calls startGame again), onHome (navigates to /dashboard)
         - Otherwise: render `<GameScreen>` (pass the game state and actions as needed, or if GameScreen calls useGameState internally, just render it)
       - IMPORTANT: If GameScreen already calls useGameState() internally (from Plan 03), then Game.tsx needs to share state. Best approach: lift useGameState() to Game.tsx and pass state + actions down as props to both GameScreen and ResultsScreen. This may require adjusting GameScreen to accept props instead of calling useGameState internally. Read GameScreen.tsx first to determine the right approach.
       - Alternative: Use a game context provider. But simplest is: Game.tsx owns state, passes down.
       - Import `useNavigate` from react-router-dom for Home button navigation
       - Full-screen layout, no nav bar (immersive mode)

    2. **Update `frontend/src/App.tsx`:**
       - Import Game page: `import { Game } from './pages/Game';`
       - Add route: `<Route path="/play" element={<Game />} />` as a public route (outside ProtectedRoute for now, or inside if game requires auth — check CONTEXT.md)
       - Per CONTEXT.md there's no explicit auth requirement for game, but since we have auth, put it inside ProtectedRoute for consistency (user must be logged in to play)

    3. **Update `frontend/src/pages/Dashboard.tsx`:**
       - Add a prominent "Quick Play" button that navigates to `/play`
       - Use `useNavigate()` from react-router-dom
       - Style: large teal button, centered, inviting — this is the main CTA
       - Brief description text: "10 questions. Test your civic knowledge." or similar
       - Keep existing dashboard content (welcome message)
  </action>
  <verify>
    Run `cd frontend && npx tsc --noEmit` to verify all changes compile.
    Check that /play route is registered in App.tsx.
    Check that Dashboard has navigation to /play.
    Start dev server: `npm run dev` from root and verify:
    1. Dashboard shows Quick Play button
    2. Clicking Quick Play navigates to /play
    3. Game starts, questions load
    4. Can play through at least 1 question
    5. After 10 questions, results screen shows
    6. Play Again restarts, Home goes to dashboard
  </verify>
  <done>
    Game page manages game lifecycle switching between GameScreen and ResultsScreen. Route /play is wired in App.tsx. Dashboard has Quick Play button. Full flow: Dashboard -> Play -> 10 Questions -> Results -> Play Again or Home.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete game flow: Dashboard Quick Play button -> 10-question trivia game with circular timer, two-step lock-in, Millionaire-style reveal animations, and results screen with expandable review</what-built>
  <how-to-verify>
    1. Start the dev server: `npm run dev` from project root
    2. Log in (or sign up if needed) at http://localhost:5173
    3. On Dashboard, click "Quick Play" button
    4. Verify game screen appears with dark Millionaire aesthetic:
       - Question text centered and prominent
       - 4 answer options in 2x2 grid (desktop) with A/B/C/D labels
       - Circular timer counting down from 20 in top-right
       - Progress dots showing current question
    5. Click an answer option — it should highlight (selected state)
    6. Click "Lock In" button — brief suspense pause, then reveal:
       - Wrong options fade out
       - Correct answer highlighted green
       - Your wrong pick (if any) highlighted red
       - Explanation shown below answers
       - "Not quite" language if incorrect (never "Wrong")
    7. Test keyboard shortcuts: press A/B/C/D keys to select answers
    8. Let one question timeout — should show "Time's up!" then reveal correct answer
    9. Play through all 10 questions
    10. Verify results screen:
        - Score as fraction (e.g., 7/10)
        - "Review Answers" button, collapsed by default
        - Expand review to see all 10 questions with answers and explanations
        - "Play Again" and "Home" buttons
    11. Click "Play Again" — new game starts with different questions
    12. Play again, click "Home" — returns to Dashboard
    13. Test quit mid-game: click X/Quit button, confirm dialog appears, quit returns to idle/dashboard
    14. Check mobile: resize browser to mobile width, verify answer grid stacks vertically
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues with the game flow</resume-signal>
</task>

</tasks>

<verification>
- Full game flow works: Dashboard -> Quick Play -> 10 questions -> Results -> Play Again / Home
- Timer counts down with color transitions
- Two-step lock-in with suspense pause
- Reveal shows correct answer with explanation
- Results screen has expandable review
- Keyboard shortcuts work
- Quit mid-game with confirmation
- Mobile responsive (answer grid stacks)
- No console errors during gameplay
</verification>

<success_criteria>
- User can start a solo quick play session from Dashboard (GAME-01)
- Game presents 10 randomized multiple-choice questions with 4 options (GAME-02)
- Visual countdown timer with color transitions (GAME-03, GAME-04)
- User can select and lock-in one answer per question (GAME-05, GAME-06)
- Answer reveal with correct/incorrect and explanation (GAME-07, GAME-08)
- Questions progress automatically after reveal (GAME-09)
- Results screen shows score and accuracy with review (GAME-14)
- 100+ questions in pool with mixed difficulty (CONT-01, CONT-02)
- Each question has correct answer and explanation (CONT-03, CONT-04)
- Questions randomized per session (CONT-05)
</success_criteria>

<output>
After completion, create `.planning/phases/02-game-core/02-04-SUMMARY.md`
</output>
