---
phase: 02-game-core
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/types/game.ts
  - backend/src/data/questions.json
  - backend/src/routes/game.ts
  - backend/src/server.ts
  - frontend/package.json
  - frontend/src/services/gameService.ts
autonomous: true

must_haves:
  truths:
    - "Game types define Question with id, text, options, correctAnswer, explanation, difficulty, and topic"
    - "Question bank contains 100+ questions spanning easy, medium, hard difficulties"
    - "API endpoint returns 10 randomized questions per request"
    - "Frontend can fetch questions from the API"
  artifacts:
    - path: "frontend/src/types/game.ts"
      provides: "Question, GameAnswer, GameResult type definitions"
      exports: ["Question", "GameAnswer", "GameResult", "GamePhase", "Difficulty"]
    - path: "backend/src/data/questions.json"
      provides: "100+ civic trivia questions with explanations"
      min_lines: 500
    - path: "backend/src/routes/game.ts"
      provides: "GET /api/game/questions endpoint"
      exports: ["router"]
    - path: "frontend/src/services/gameService.ts"
      provides: "fetchQuestions function for API calls"
      exports: ["fetchQuestions"]
  key_links:
    - from: "backend/src/routes/game.ts"
      to: "backend/src/data/questions.json"
      via: "JSON import and Fisher-Yates shuffle"
      pattern: "shuffle.*slice.*10"
    - from: "backend/src/server.ts"
      to: "backend/src/routes/game.ts"
      via: "app.use('/api/game', gameRouter)"
      pattern: "app\\.use.*game"
    - from: "frontend/src/services/gameService.ts"
      to: "/api/game/questions"
      via: "fetch call through api service"
      pattern: "api.*game.*questions"
---

<objective>
Create the data foundation for the game: shared TypeScript types, a 100+ question bank with civic trivia content, a backend API endpoint that returns 10 randomized questions, and a frontend service to fetch them. Also install framer-motion and react-countdown-circle-timer dependencies.

Purpose: Everything in Phase 2 depends on having question data and types. This plan creates the foundation that the game state machine and UI components will consume.
Output: Types, question data, API endpoint, frontend service, new dependencies installed.
</objective>

<execution_context>
@C:\Users\Chris\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Chris\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-game-core/02-CONTEXT.md
@.planning/phases/02-game-core/02-RESEARCH.md
@backend/src/server.ts
@frontend/package.json
@frontend/src/services/api.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Define game types and install dependencies</name>
  <files>
    frontend/src/types/game.ts
    frontend/package.json
  </files>
  <action>
    1. Install dependencies in the frontend directory:
       ```
       npm install framer-motion react-countdown-circle-timer
       ```
       Install types if needed: `npm install -D @types/react-countdown-circle-timer` (check if bundled first).

    2. Create `frontend/src/types/game.ts` with these TypeScript types:

       - `Difficulty`: union type `'easy' | 'medium' | 'hard'`
       - `Question`: `{ id: string; text: string; options: string[]; correctAnswer: number; explanation: string; difficulty: Difficulty; topic: string }`
         - `correctAnswer` is the index (0-3) of the correct option in the options array
         - `options` is always exactly 4 strings
       - `GamePhase`: union type `'idle' | 'starting' | 'answering' | 'selected' | 'locked' | 'revealing' | 'complete'`
         - `idle`: no game in progress
         - `starting`: brief countdown before first question
         - `answering`: timer running, player can select
         - `selected`: player has highlighted an answer but not locked in
         - `locked`: player confirmed answer, suspense pause
         - `revealing`: showing correct/incorrect + explanation
         - `complete`: all 10 questions done, show results
       - `GameAnswer`: `{ questionId: string; selectedOption: number | null; correct: boolean; timeRemaining: number }`
       - `GameResult`: `{ answers: GameAnswer[]; totalCorrect: number; totalQuestions: number }`
       - `GameState`: `{ phase: GamePhase; questions: Question[]; currentQuestionIndex: number; selectedOption: number | null; answers: GameAnswer[]; isTimerPaused: boolean }`

       Export all types. Use `export type` for type-only exports (ESM best practice).
  </action>
  <verify>
    Run `cd frontend && npx tsc --noEmit` to verify types compile.
    Check `node_modules/framer-motion` and `node_modules/react-countdown-circle-timer` exist.
  </verify>
  <done>
    All game types exported from frontend/src/types/game.ts. framer-motion and react-countdown-circle-timer installed in frontend/package.json.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create question bank with 100+ civic trivia questions</name>
  <files>
    backend/src/data/questions.json
  </files>
  <action>
    Create `backend/src/data/questions.json` containing an array of 100+ civic trivia questions about U.S. government, policy, and civic systems. Each question object must have:

    ```json
    {
      "id": "q001",
      "text": "How many amendments are in the Bill of Rights?",
      "options": ["8", "10", "12", "15"],
      "correctAnswer": 1,
      "explanation": "The Bill of Rights consists of the first 10 amendments to the U.S. Constitution, ratified in 1791.",
      "difficulty": "easy",
      "topic": "Constitution"
    }
    ```

    Requirements:
    - Minimum 100 questions, aim for 110-120 for variety
    - Distribution: ~35 easy, ~40 medium, ~30 hard
    - Topics should span: Constitution, Branches of Government, Elections, Civil Rights, Amendments, Supreme Court, State Government, Civic Participation, U.S. History (civic-relevant), Current Civic Systems
    - Each question has exactly 4 options with exactly 1 correct answer
    - `correctAnswer` is the zero-based index of the correct option
    - Explanation is 1-3 sentences, neutral and informative (never judgmental)
    - Use "Not quite" tone — explanations teach, never condescend
    - All facts must be accurate and verifiable
    - IDs should be sequential: q001, q002, ..., q100+
    - Randomize correct answer position (don't always put it in position 0 or 1)

    IMPORTANT: Take care with factual accuracy. These are educational questions about civics.
  </action>
  <verify>
    Parse the JSON file to verify:
    - Valid JSON (no syntax errors)
    - At least 100 questions
    - Each question has all required fields
    - correctAnswer is 0-3 for each question
    - difficulty is one of "easy", "medium", "hard"
    - No duplicate IDs

    Use a quick script: `node -e "const q=require('./backend/src/data/questions.json'); console.log('Total:', q.length); console.log('Easy:', q.filter(x=>x.difficulty==='easy').length); console.log('Medium:', q.filter(x=>x.difficulty==='medium').length); console.log('Hard:', q.filter(x=>x.difficulty==='hard').length); const ids=q.map(x=>x.id); console.log('Unique IDs:', new Set(ids).size); console.log('All have explanation:', q.every(x=>x.explanation?.length > 0)); console.log('Valid correctAnswer:', q.every(x=>x.correctAnswer>=0 && x.correctAnswer<=3));"`
  </verify>
  <done>
    100+ civic trivia questions in valid JSON format, spanning easy/medium/hard difficulties across multiple civic topics. Each question has 4 options, 1 correct answer, and an educational explanation.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create game API endpoint and frontend service</name>
  <files>
    backend/src/routes/game.ts
    backend/src/server.ts
    frontend/src/services/gameService.ts
  </files>
  <action>
    1. Create `backend/src/routes/game.ts`:
       - Import questions from `../data/questions.json` (use createRequire or fs.readFileSync for JSON in ESM — check how the backend handles JSON imports based on tsconfig)
       - Implement Fisher-Yates shuffle utility function (inline, not imported)
       - `GET /questions` endpoint:
         - Reads all questions from the JSON
         - Shuffles using Fisher-Yates
         - Takes first 10
         - Returns `{ questions: Question[] }` with 200 status
         - Does NOT require authentication (game is playable without login for now)
       - Export the router

    2. Mount the game router in `backend/src/server.ts`:
       - Import: `import { router as gameRouter } from './routes/game.js';`
       - Mount: `app.use('/api/game', gameRouter);`
       - Place AFTER the auth router mount

    3. Create `frontend/src/services/gameService.ts`:
       - Import the API helper from `./api` (use the existing apiRequest pattern from authService.ts as reference)
       - `fetchQuestions()`: GET request to `/api/game/questions`, returns `Question[]` from the response
       - Export the function
       - Follow the same patterns used in `frontend/src/services/authService.ts` for API calls
  </action>
  <verify>
    1. Start the backend: `cd backend && npx tsx src/server.ts` (or use the existing dev command)
    2. Test the endpoint: `curl http://localhost:3000/api/game/questions`
    3. Verify response has exactly 10 questions, each with all required fields
    4. Call twice and verify different order (randomization works)
    5. Run TypeScript check: `cd frontend && npx tsc --noEmit`
  </verify>
  <done>
    GET /api/game/questions returns 10 randomized civic trivia questions. Frontend gameService.ts can fetch questions using the existing API service pattern. Backend serves shuffled questions from the 100+ question bank.
  </done>
</task>

</tasks>

<verification>
- `curl http://localhost:3000/api/game/questions | jq '.questions | length'` returns 10
- `cd frontend && npx tsc --noEmit` passes with no errors
- Question bank has 100+ questions verified by JSON parse script
- framer-motion and react-countdown-circle-timer appear in frontend/package.json dependencies
</verification>

<success_criteria>
- 100+ civic trivia questions stored in backend JSON file
- API endpoint returns 10 randomized questions per request
- All game types defined and compiling in TypeScript
- Frontend service can call the questions API
- Animation and timer libraries installed and ready
</success_criteria>

<output>
After completion, create `.planning/phases/02-game-core/02-01-SUMMARY.md`
</output>
