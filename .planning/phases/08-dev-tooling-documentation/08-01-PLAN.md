---
phase: 08-dev-tooling-documentation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - backend/package.json
  - backend/src/scripts/generateLearningContent.ts
autonomous: true
user_setup:
  - service: anthropic
    why: "AI content generation via Claude API"
    env_vars:
      - name: ANTHROPIC_API_KEY
        source: "Anthropic Console -> API Keys (https://console.anthropic.com/settings/keys)"

must_haves:
  truths:
    - "generateLearningContent.ts compiles without TypeScript errors"
    - "Script loads API key from ANTHROPIC_API_KEY env var or .env file"
    - "Script outputs generated content to console/temp file instead of auto-writing to questions.json"
    - "Generated content includes source citations from authoritative .gov sites"
  artifacts:
    - path: "backend/package.json"
      provides: "@anthropic-ai/sdk devDependency"
      contains: "@anthropic-ai/sdk"
    - path: "backend/src/scripts/generateLearningContent.ts"
      provides: "Working content generation script"
      contains: "ANTHROPIC_API_KEY"
  key_links:
    - from: "backend/src/scripts/generateLearningContent.ts"
      to: "@anthropic-ai/sdk"
      via: "import Anthropic from @anthropic-ai/sdk"
      pattern: "import Anthropic from"
    - from: "backend/src/scripts/generateLearningContent.ts"
      to: "dotenv"
      via: "import dotenv/config for .env loading"
      pattern: "dotenv"
---

<objective>
Fix the generateLearningContent.ts script so it compiles and runs correctly, with preview-before-commit workflow.

Purpose: The content generation script is broken (missing SDK dependency, wrong env var name) and auto-writes to data files. This plan installs the SDK, fixes configuration, and changes the script to output content for review before committing — a locked user decision.
Output: Working script that can generate learning content on demand with developer review step.
</objective>

<execution_context>
@C:\Users\Chris\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Chris\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@backend/src/scripts/generateLearningContent.ts
@backend/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install @anthropic-ai/sdk and verify TypeScript compilation</name>
  <files>backend/package.json</files>
  <action>
    Run `npm install --save-dev @anthropic-ai/sdk` in the backend directory.

    After install, verify the script compiles by running `npx tsc --noEmit backend/src/scripts/generateLearningContent.ts` or equivalent TypeScript check. If there are type errors beyond the SDK import, fix them.
  </action>
  <verify>Run `cd backend && npx tsc --noEmit` (or `npx tsx --eval "import './src/scripts/generateLearningContent.ts'"` dry-run). No TypeScript compilation errors.</verify>
  <done>@anthropic-ai/sdk appears in backend/package.json devDependencies and the script compiles without TypeScript errors.</done>
</task>

<task type="auto">
  <name>Task 2: Fix env var, add dotenv support, and implement preview-before-commit output</name>
  <files>backend/src/scripts/generateLearningContent.ts</files>
  <action>
    Make these changes to generateLearningContent.ts:

    1. **Fix environment variable name:** Change all references from `CLAUDE_API_KEY` to `ANTHROPIC_API_KEY`. This is the default expected by @anthropic-ai/sdk. Update:
       - The Anthropic client initialization (line 31-33): Use `process.env.ANTHROPIC_API_KEY` or let the SDK auto-detect (it reads ANTHROPIC_API_KEY by default — you can omit the apiKey parameter entirely and let the SDK handle it).
       - The API key check (line 165-168): Check for `ANTHROPIC_API_KEY`.
       - The usage comment at top of file (line 1): Update to `ANTHROPIC_API_KEY=sk-xxx`.

    2. **Add dotenv support:** Add `import 'dotenv/config';` as the FIRST import line (before the Anthropic import). This ensures .env file is loaded before any env var reads. dotenv is already a dependency in backend/package.json.

    3. **Preview-before-commit workflow (LOCKED DECISION):** Instead of writing results back to questions.json with writeFileSync:
       - Remove the writeFileSync call at line 195 that overwrites questions.json.
       - After processing all questions, write the generated content to a temp file: `backend/generated-content-{timestamp}.json` containing only the newly generated learningContent keyed by question ID. Format: `{ "q_001": { learningContent: {...} }, "q_002": { learningContent: {...} } }`.
       - Print a summary to console showing: each question ID, first sentence of first paragraph (truncated to 80 chars), and the source URL.
       - Print instructions: "Review the generated content in {filename}. To apply, run: npx tsx backend/src/scripts/applyContent.ts {filename}" (the apply script is out of scope for this phase, but the message guides the workflow).
       - Remove the `writeFileSync` import if no longer needed (keep `readFileSync`).

    4. **Update the run comment at top:** Change to:
       `// Run: ANTHROPIC_API_KEY=sk-xxx npx tsx backend/src/scripts/generateLearningContent.ts`
       `// Or: Create backend/.env with ANTHROPIC_API_KEY=sk-xxx`

    Do NOT change the prompt template, retry logic, or validation — those work correctly.
  </action>
  <verify>
    1. `grep -n "CLAUDE_API_KEY" backend/src/scripts/generateLearningContent.ts` returns no matches (old env var fully removed).
    2. `grep -n "ANTHROPIC_API_KEY" backend/src/scripts/generateLearningContent.ts` returns matches (new env var in use).
    3. `grep -n "dotenv/config" backend/src/scripts/generateLearningContent.ts` returns a match (dotenv loaded).
    4. `grep -n "writeFileSync.*questionsPath" backend/src/scripts/generateLearningContent.ts` returns no matches (no longer auto-writes to questions.json).
    5. `cd backend && npx tsc --noEmit` passes with no errors.
  </verify>
  <done>Script uses ANTHROPIC_API_KEY, loads .env via dotenv, outputs to temp file for review instead of auto-writing to questions.json, and compiles cleanly.</done>
</task>

</tasks>

<verification>
1. `cd backend && npx tsc --noEmit` completes with zero errors
2. `grep "CLAUDE_API_KEY" backend/src/scripts/generateLearningContent.ts` returns nothing
3. `grep "@anthropic-ai/sdk" backend/package.json` shows it in devDependencies
4. Script can be invoked without API key and exits with clear error message about ANTHROPIC_API_KEY
</verification>

<success_criteria>
- generateLearningContent.ts compiles without TypeScript errors
- @anthropic-ai/sdk installed as devDependency
- Script uses ANTHROPIC_API_KEY (not CLAUDE_API_KEY)
- Script supports .env file via dotenv
- Script outputs to temp file for review, not directly to questions.json
- Source citations requirement preserved in prompt template
</success_criteria>

<output>
After completion, create `.planning/phases/08-dev-tooling-documentation/08-01-SUMMARY.md`
</output>
