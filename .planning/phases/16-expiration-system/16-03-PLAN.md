---
phase: 16-expiration-system
plan: 03
type: execute
wave: 3
depends_on: ["16-02"]
files_modified:
  - frontend/src/pages/Admin.tsx
  - frontend/src/features/admin/hooks/useAdminQuestions.ts
  - frontend/src/features/admin/types.ts
  - frontend/src/App.tsx
  - frontend/src/components/layout/Header.tsx
autonomous: false

must_haves:
  truths:
    - "Logged-in user can navigate to /admin and see a list of expired and expiring-soon questions"
    - "Each question row shows text, status, collection names, expiry date, and action buttons"
    - "Renew action prompts for new expiry date and immediately reactivates the question"
    - "Archive action permanently retires a question with confirmation"
    - "Admin page is only accessible to logged-in users (redirects to login if anonymous)"
    - "Status filter allows viewing expired, expiring-soon, or archived questions separately"
  artifacts:
    - path: "frontend/src/pages/Admin.tsx"
      provides: "Admin page component with question list and action buttons"
      min_lines: 80
    - path: "frontend/src/features/admin/hooks/useAdminQuestions.ts"
      provides: "Hook for fetching and managing admin question data"
      exports: ["useAdminQuestions"]
    - path: "frontend/src/features/admin/types.ts"
      provides: "TypeScript types for admin question data"
      exports: ["AdminQuestion"]
    - path: "frontend/src/App.tsx"
      provides: "Route registration for /admin inside ProtectedRoute"
      contains: "admin"
  key_links:
    - from: "frontend/src/features/admin/hooks/useAdminQuestions.ts"
      to: "backend/src/routes/admin.ts"
      via: "apiRequest calls to /api/admin/questions endpoints"
      pattern: "/api/admin/questions"
    - from: "frontend/src/App.tsx"
      to: "frontend/src/pages/Admin.tsx"
      via: "React Router Route inside ProtectedRoute"
      pattern: "path.*admin"
    - from: "frontend/src/components/layout/Header.tsx"
      to: "frontend/src/pages/Admin.tsx"
      via: "Navigation link to /admin for authenticated users"
      pattern: "/admin"
---

<objective>
Build the admin review page where authenticated users can view and manage expired and expiring-soon questions.

Purpose: This completes the review workflow from CONTEXT.md — content reviewers need a simple page to see what has expired, what is expiring soon, and take action (renew with new date, update content + renew, or archive). This is the user-facing surface for the expiration system.

Output: A protected /admin route with a table of expired/expiring-soon questions, status filter tabs, and action buttons for renew and archive.
</objective>

<execution_context>
@C:\Users\Chris\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Chris\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-expiration-system/16-CONTEXT.md
@.planning/phases/16-expiration-system/16-01-SUMMARY.md
@.planning/phases/16-expiration-system/16-02-SUMMARY.md

Key existing files:
@frontend/src/App.tsx
@frontend/src/services/api.ts
@frontend/src/store/authStore.ts
@frontend/src/components/layout/Header.tsx
@frontend/src/pages/Profile.tsx
@frontend/src/components/ProtectedRoute.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Admin types, hook, and page component</name>
  <files>frontend/src/features/admin/types.ts, frontend/src/features/admin/hooks/useAdminQuestions.ts, frontend/src/pages/Admin.tsx</files>
  <action>
  1. Create `frontend/src/features/admin/types.ts`:

  ```typescript
  export interface AdminQuestion {
    id: number;           // Database serial ID (used for API actions)
    externalId: string;   // Display ID like "q001"
    text: string;
    difficulty: string;
    expiresAt: string | null;
    status: 'active' | 'expired' | 'archived';
    collectionNames: string[];
    expirationHistory: Array<{
      action: 'expired' | 'renewed' | 'archived';
      timestamp: string;
      previousExpiresAt?: string;
      newExpiresAt?: string;
    }>;
  }

  export type StatusFilter = 'all' | 'expired' | 'expiring-soon' | 'archived';
  ```

  2. Create `frontend/src/features/admin/hooks/useAdminQuestions.ts`:

  Export a `useAdminQuestions()` hook that:
  - Maintains state: `questions: AdminQuestion[]`, `loading: boolean`, `error: string | null`, `filter: StatusFilter`
  - On mount and when filter changes, calls `apiRequest<{ questions: AdminQuestion[] }>('/api/admin/questions?status={filter}', { headers: { Authorization: \`Bearer ${accessToken}\` } })` — get accessToken from `useAuthStore.getState().accessToken`
  - For 'all' filter, omit the status query param
  - Exports `fetchQuestions()` for manual refresh after actions
  - Exports `renewQuestion(id: number, expiresAt: string): Promise<void>` — calls `apiRequest('/api/admin/questions/${id}/renew', { method: 'POST', headers: { Authorization: ... }, body: JSON.stringify({ expiresAt }) })`, then calls `fetchQuestions()` to refresh list
  - Exports `archiveQuestion(id: number): Promise<void>` — calls `apiRequest('/api/admin/questions/${id}/archive', { method: 'POST', headers: { Authorization: ... } })`, then calls `fetchQuestions()` to refresh list
  - Exports `setFilter(filter: StatusFilter)` to change the active filter
  - Returns `{ questions, loading, error, filter, setFilter, renewQuestion, archiveQuestion }`

  3. Create `frontend/src/pages/Admin.tsx`:

  A full admin page using the project's Tailwind styling patterns (similar to Dashboard.tsx and Profile.tsx). Structure:

  - Import and use `Header` component at top (same as Dashboard)
  - Page title: "Content Review" with subtitle "Manage expired and expiring-soon questions"
  - **Filter tabs**: Row of buttons for 'All', 'Expired', 'Expiring Soon', 'Archived' — active tab highlighted with teal background (matching project theme)
  - **Question table/list**: For each question, show:
    - Status badge: colored pill (red for 'expired', yellow/amber for expiring-soon based on `status='active'` + `expiresAt` being present, gray for 'archived')
    - Question text (truncated to ~80 chars with ellipsis if longer)
    - External ID (e.g., "q001") in muted text
    - Collection names as comma-separated tags
    - Expires at date formatted as readable string (e.g., "Mar 15, 2026")
    - Difficulty badge (easy=green, medium=yellow, hard=red — small pill)
    - **Action buttons**:
      - "Renew" button (teal, shown for expired and expiring-soon): Opens a simple inline form or prompt asking for new expiry date (use `<input type="date">` for simplicity). On submit, calls `renewQuestion(id, selectedDate)`. The date input should default to 1 year from today.
      - "Archive" button (red/gray, shown for expired): Calls `archiveQuestion(id)` with a `window.confirm('Archive this question permanently? It will not appear in any future games.')` confirmation first.
  - **Empty state**: If no questions match the filter, show a friendly message like "No expired questions found" with a check mark icon
  - **Loading state**: Show a spinner or skeleton while loading
  - **Error state**: Show error message in red if API call fails
  - Use responsive layout: table on large screens, card list on mobile (use Tailwind responsive classes)

  Styling notes:
  - Follow the same container pattern as Dashboard: `min-h-screen bg-gray-50`, `max-w-7xl mx-auto`, `bg-white shadow rounded-lg p-6`
  - Use teal-600 for primary actions (matching existing button styles)
  - Status badges: Use Tailwind's rounded-full px-2 py-1 text-xs font-medium pattern
  - min-h-[48px] on all interactive elements for touch target accessibility (project pattern)
  </action>
  <verify>
  - `cd frontend && npx tsc --noEmit` compiles without errors
  - Admin.tsx imports Header, useAdminQuestions hook, and AdminQuestion type
  - useAdminQuestions hook imports apiRequest and useAuthStore
  </verify>
  <done>Admin page component renders question list with status badges, filter tabs, renew/archive actions, and responsive layout. Hook handles all API communication with auth headers.</done>
</task>

<task type="auto">
  <name>Task 2: Route registration and navigation link</name>
  <files>frontend/src/App.tsx, frontend/src/components/layout/Header.tsx</files>
  <action>
  1. In `frontend/src/App.tsx`:
  - Add import: `import { Admin } from './pages/Admin';`
  - Add `/admin` route INSIDE the existing `<Route element={<ProtectedRoute />}>` block (after the Profile route, around line 35):
    ```tsx
    <Route path="/admin" element={<Admin />} />
    ```
  - This ensures only authenticated users can access the admin page (ProtectedRoute handles redirect to /login)

  2. In `frontend/src/components/layout/Header.tsx`:
  - Add a navigation link to the admin page, visible ONLY to authenticated users
  - Look at how the existing header handles auth state (it likely uses `useAuthStore`)
  - Add a link labeled "Review" or "Admin" next to the Profile link, using the same styling pattern
  - Use `<Link to="/admin">` from react-router-dom
  - Position it in the navigation area, before or after the Profile link
  - Use the same text/link styling as other nav items in the header

  IMPORTANT: Read Header.tsx first to understand the exact structure before modifying. Follow the existing pattern for authenticated vs anonymous nav items exactly.
  </action>
  <verify>
  - `cd frontend && npx tsc --noEmit` compiles without errors
  - App.tsx has `/admin` route inside ProtectedRoute
  - Header.tsx shows "Review" link for authenticated users
  - Navigating to /admin while logged out redirects to /login
  </verify>
  <done>Admin page accessible at /admin behind auth. Header shows navigation link for logged-in users. Anonymous users redirected to login.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete expiration system: cron sweep, health endpoint, admin page with renew/archive actions</what-built>
  <how-to-verify>
  1. Start the backend: `cd backend && npm run dev`
  2. Start the frontend: `cd frontend && npm run dev`
  3. Visit http://localhost:5173 and log in
  4. Check the header — you should see a "Review" or "Admin" navigation link
  5. Click it to navigate to /admin — you should see the admin review page
  6. The page should show filter tabs (All, Expired, Expiring Soon, Archived)
  7. Since no questions have expires_at set, the list should be empty with a friendly message
  8. Visit http://localhost:3000/health/collections in a new tab — should return JSON with Federal Civics collection showing activeCount=120, tier='Healthy'
  9. Log out and try visiting /admin directly — should redirect to /login
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues</resume-signal>
</task>

</tasks>

<verification>
- /admin route exists inside ProtectedRoute in App.tsx
- Header shows navigation link to /admin for authenticated users
- Admin page renders with filter tabs, question list, and action buttons
- useAdminQuestions hook communicates with /api/admin/questions endpoints
- AdminQuestion type matches backend response shape
- TypeScript compiles cleanly on both frontend and backend
- Anonymous users redirected to login when visiting /admin
</verification>

<success_criteria>
- ADM-01 fully satisfied: Admin page shows expired/expiring-soon questions with management actions
- EXP-03 fully satisfied: Review workflow complete — expired questions surfaced in admin UI with renew/archive actions
- All 5 requirements (EXP-01 through EXP-04, ADM-01) are covered across Plans 01-03
</success_criteria>

<output>
After completion, create `.planning/phases/16-expiration-system/16-03-SUMMARY.md`
</output>
