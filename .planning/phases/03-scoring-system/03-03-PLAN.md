---
phase: 03-scoring-system
plan: 03
type: execute
wave: 3
depends_on: ["03-02"]
files_modified:
  - frontend/src/features/game/components/ScoreDisplay.tsx
  - frontend/src/features/game/components/ScorePopup.tsx
  - frontend/src/features/game/components/GameScreen.tsx
  - frontend/src/features/game/components/ResultsScreen.tsx
  - frontend/src/pages/Game.tsx
autonomous: false

must_haves:
  truths:
    - "Running score is visible during game and updates with animation on answer reveal"
    - "Correct answers show floating +100 base and +N speed bonus popups that merge into total"
    - "Wrong answers trigger subtle shake/red flash on score area"
    - "Timeout shows distinct orange/amber treatment"
    - "Results screen shows total score with base vs speed split"
    - "Per-question review shows points badge on collapsed view and base+speed breakdown when expanded"
    - "Fastest answer is highlighted with response time"
    - "Perfect game (10/10) gets special golden treatment"
  artifacts:
    - path: "frontend/src/features/game/components/ScoreDisplay.tsx"
      provides: "Animated score counter using useMotionValue, shake on wrong answer, red flash"
      min_lines: 40
    - path: "frontend/src/features/game/components/ScorePopup.tsx"
      provides: "Floating +points popups with stagger, teal accent for speed bonus"
      min_lines: 30
    - path: "frontend/src/features/game/components/GameScreen.tsx"
      provides: "ScoreDisplay integrated into top HUD, ScorePopup shown during reveal phase"
      contains: "ScoreDisplay"
    - path: "frontend/src/features/game/components/ResultsScreen.tsx"
      provides: "Score summary, per-question points badges, fastest answer callout, perfect game treatment"
      contains: "totalScore"
  key_links:
    - from: "frontend/src/features/game/components/GameScreen.tsx"
      to: "frontend/src/features/game/components/ScoreDisplay.tsx"
      via: "renders ScoreDisplay with totalScore from state"
      pattern: "ScoreDisplay"
    - from: "frontend/src/features/game/components/GameScreen.tsx"
      to: "frontend/src/features/game/components/ScorePopup.tsx"
      via: "renders ScorePopup during reveal phase with latest answer's score data"
      pattern: "ScorePopup"
    - from: "frontend/src/features/game/components/ResultsScreen.tsx"
      to: "frontend/src/types/game.ts"
      via: "uses GameResult.totalScore, totalBasePoints, totalSpeedBonus, fastestAnswer"
      pattern: "totalScore|totalBasePoints|fastestAnswer"
---

<objective>
Build the score display UI: animated running score on game screen with floating point popups, shake/flash on wrong answers, orange timeout treatment, and enhanced results screen with score breakdown, per-question points, fastest answer callout, and perfect game celebration.

Purpose: Makes scoring feel like a game show — dramatic reveals, satisfying feedback, clean breakdowns.
Output: ScoreDisplay and ScorePopup components, updated GameScreen and ResultsScreen.
</objective>

<execution_context>
@C:\Users\Chris\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Chris\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-scoring-system/03-CONTEXT.md
@.planning/phases/03-scoring-system/03-RESEARCH.md
@.planning/phases/03-scoring-system/03-02-SUMMARY.md
@frontend/src/features/game/components/GameScreen.tsx
@frontend/src/features/game/components/ResultsScreen.tsx
@frontend/src/types/game.ts
@frontend/src/pages/Game.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create ScoreDisplay and ScorePopup components, integrate into GameScreen</name>
  <files>
    frontend/src/features/game/components/ScoreDisplay.tsx
    frontend/src/features/game/components/ScorePopup.tsx
    frontend/src/features/game/components/GameScreen.tsx
    frontend/src/pages/Game.tsx
  </files>
  <action>
Create `frontend/src/features/game/components/ScoreDisplay.tsx`:
- Animated score counter using Framer Motion useMotionValue + animate() with spring physics (stiffness: 100, damping: 20, mass: 0.5) per RESEARCH.md pattern
- Props: `score: number`, `shouldShake: boolean`, `showRedFlash: boolean`
- When `shouldShake` is true, animate x: [0, -10, 10, -10, 10, 0] over 0.5s (wrong answer feedback)
- When `showRedFlash` is true, overlay a red bg that fades from opacity 0.3 to 0
- Display format: score number with "pts" label below, clean typography
- Score is static/hidden during 'answering' phase — only updates on reveal (per CONTEXT.md: "Score is static/hidden during question phase — updates only on answer reveal")
- Place in top HUD area of GameScreen (Claude's discretion per CONTEXT.md — recommend between progress dots and timer, or below the top bar)

Create `frontend/src/features/game/components/ScorePopup.tsx`:
- Floating score popup component using AnimatePresence for enter/exit animations
- Props: `basePoints: number`, `speedBonus: number`, `isCorrect: boolean`, `isTimeout: boolean`, `onComplete: () => void`
- Correct answer flow: Show "+100" in white/gold first (spring in from below, scale 0.5->1, delay 0), then "+N speed bonus" in teal-400 (delay 0.15s), both float up and fade out after ~1.5s, call onComplete
- If speedBonus is 0, only show base points popup (no "speed bonus" line)
- Wrong answer: Don't show popup (shake/flash handles it)
- Timeout: Show "Time's up!" in orange/amber text (amber-500), distinct from wrong answer red and correct green (per CONTEXT.md 3-state system)
- Use AnimatePresence with unique keys for proper exit animations
- Position: overlay centered on the game area (absolute positioning)

Update `frontend/src/features/game/components/GameScreen.tsx`:
- Import and render ScoreDisplay in the top HUD bar (between quit button and timer, or as a separate row below — pick what looks cleanest with existing layout)
- Pass `totalScore` from game state to ScoreDisplay
- Determine shouldShake/showRedFlash: when phase transitions to 'revealing' and the latest answer is incorrect (not timeout), set shouldShake=true for 0.5s
- Render ScorePopup during 'revealing' phase with the latest answer's score data
- For timeout: detect when latest answer has selectedOption === null and show timeout popup instead
- ScorePopup onComplete callback: no action needed (auto-advance handles progression)
- GameScreen needs totalScore prop — update GameScreenProps interface to include `totalScore: number` and `latestAnswer: GameAnswer | null` (or derive from state.answers)

Update `frontend/src/pages/Game.tsx`:
- Pass `totalScore` (from state.totalScore) and latest answer data to GameScreen
- Pass score-related data to ResultsScreen (already gets gameResult which now has score fields)
  </action>
  <verify>
1. `cd frontend && npx tsc --noEmit` passes
2. Start dev servers, play a game
3. Score counter visible in top HUD, starts at 0
4. On correct answer: floating "+100" and "+N speed bonus" popups appear, score counter animates up
5. On wrong answer: score area shakes with red flash, no points popup
6. On timeout: "Time's up!" in orange/amber, no points
  </verify>
  <done>
Running score displayed in game HUD with spring-animated counter. Correct answers show staggered base + speed bonus popups. Wrong answers trigger shake + red flash. Timeouts show distinct orange treatment. All animations use Framer Motion with proper AnimatePresence.
  </done>
</task>

<task type="auto">
  <name>Task 2: Enhance ResultsScreen with score breakdown, fastest answer, and perfect game</name>
  <files>
    frontend/src/features/game/components/ResultsScreen.tsx
  </files>
  <action>
Overhaul `frontend/src/features/game/components/ResultsScreen.tsx` to show full score breakdown per CONTEXT.md decisions:

**Summary section at top (replace current score display):**
- Large total score with animated counter (reuse useMotionValue pattern)
- Below total: "X base + Y speed bonus" split text (e.g., "1,250 pts -- 1,000 base + 250 speed")
- Do NOT show theoretical max — just the score (per CONTEXT.md)
- Keep accuracy display (X/10 and percentage) but make it secondary to the score
- Perfect game detection: if totalCorrect === totalQuestions (10/10), apply special treatment:
  - Golden text color (amber-400/yellow-400) on the score
  - "Perfect Game!" label with a subtle scale animation
  - Different entrance animation (more dramatic, perhaps a brief pulse/glow)

**Fastest answer callout:**
- If fastestAnswer exists in gameResult, show a highlighted card/callout:
  - "Fastest: Q{N} ({X.X}s) -- +{points} pts"
  - Teal accent styling to make it stand out
  - Position: between score summary and review section (Claude's discretion on exact placement — stat card or inline)

**Per-question review section updates:**
- Each question in the expandable review now shows a points badge on the COLLAPSED view:
  - Correct: "+{totalPoints}" in teal/green (e.g., "+150")
  - Incorrect: "+0" in muted slate
  - Timeout: "+0" in amber/orange
- When EXPANDED, show base + speed breakdown:
  - "Base: +100 | Speed: +50" (or "+100 base + 50 speed bonus")
  - For incorrect/timeout: "No points awarded"
- Make each question individually expandable (currently the whole review section toggles). Each question row should be a collapsible accordion item with the question text and points badge visible when collapsed, and answer details + explanation + score breakdown visible when expanded.

**Visual polish:**
- Format scores with comma separators for readability (1,250 not 1250)
- Use consistent color system: teal for score/positive, red for incorrect, amber/orange for timeout
- Animate score summary entrance with staggered delays (score first, then split, then fastest answer)

Keep existing Play Again and Home buttons. Keep existing animation patterns (motion.div with initial/animate).
  </action>
  <verify>
1. `cd frontend && npx tsc --noEmit` passes
2. Play a full game, reach results screen
3. Total score displayed prominently with base/speed split below
4. If any correct answers: fastest answer callout visible with response time
5. Review section shows points badge per question on collapsed view
6. Expanding a question shows base + speed breakdown
7. Play a perfect game (or temporarily hardcode): golden score + "Perfect Game!" label appears
  </verify>
  <done>
Results screen shows: total score with base/speed split, fastest answer callout, per-question points badges (collapsed) with score breakdown (expanded), individual question accordions, perfect game golden treatment. Scores formatted with commas.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete scoring system: server-side calculation, animated score display during game, floating point popups, shake/flash on wrong answers, orange timeout treatment, results screen with full score breakdown, fastest answer callout, and perfect game celebration.</what-built>
  <how-to-verify>
1. Start dev servers (backend + frontend)
2. Navigate to /play and start a game
3. Answer a question correctly and quickly (within first 10s):
   - Verify "+100" popup appears in white/gold
   - Verify "+50 speed bonus" popup appears in teal
   - Verify score counter in HUD animates up to 150
4. Answer a question incorrectly:
   - Verify score area shakes with brief red flash
   - Verify no points popup appears
   - Verify score stays the same
5. Let a question time out:
   - Verify "Time's up!" appears in orange/amber (NOT red)
   - Verify score stays the same
6. Complete all 10 questions and check results screen:
   - Total score with "X base + Y speed" split visible
   - Fastest answer callout with response time
   - Per-question points badges visible on collapsed rows
   - Expand a question — base + speed breakdown shown
7. (Optional) If you get 10/10: verify golden score and "Perfect Game!" label
8. Check Network tab: all POST /answer requests return score data, no client-side score calculation
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
1. Frontend and backend compile without errors
2. Full game flow works end-to-end with server scoring
3. Score animations are smooth (no jank)
4. Score popups use correct colors (white/gold base, teal speed, amber timeout)
5. Results screen shows all required breakdowns
6. Perfect game gets special treatment
7. All scores server-calculated (Network tab confirms)
</verification>

<success_criteria>
- Running score visible during game, updates only on reveal
- Correct: staggered base + speed popups, counter animates up
- Wrong: shake + red flash, no points
- Timeout: orange "Time's up!", distinct from wrong
- Results: total with base/speed split, fastest answer, per-question badges
- Perfect game: golden score, "Perfect Game!" label
- Human verification passed
</success_criteria>

<output>
After completion, create `.planning/phases/03-scoring-system/03-03-SUMMARY.md`
</output>
