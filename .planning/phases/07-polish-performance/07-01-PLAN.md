---
phase: 07-polish-performance
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/package.json
  - frontend/src/index.css
  - frontend/src/App.tsx
  - frontend/src/main.tsx
  - frontend/tailwind.config.js
  - frontend/src/store/announcementStore.ts
  - frontend/src/components/accessibility/LiveRegions.tsx
  - frontend/src/components/accessibility/SkipToContent.tsx
  - frontend/src/hooks/useReducedMotion.ts
  - frontend/src/utils/announce.ts
  - frontend/src/features/game/components/LearnMoreModal.tsx
  - frontend/src/shared/components/ConfirmDialog.tsx
autonomous: true

must_haves:
  truths:
    - "Skip-to-content link appears on Tab press and jumps to main content"
    - "ARIA live regions exist in DOM and announcements can be triggered programmatically"
    - "All interactive elements show custom teal/amber focus rings on keyboard navigation"
    - "Modals trap focus within themselves and return focus on close"
    - "Reduced motion preference disables animations"
  artifacts:
    - path: "frontend/src/store/announcementStore.ts"
      provides: "Zustand store for screen reader announcements"
      exports: ["useAnnouncementStore"]
    - path: "frontend/src/utils/announce.ts"
      provides: "Helper functions for polite and assertive announcements"
      exports: ["announce"]
    - path: "frontend/src/components/accessibility/LiveRegions.tsx"
      provides: "Persistent ARIA live region containers"
      exports: ["LiveRegions"]
    - path: "frontend/src/components/accessibility/SkipToContent.tsx"
      provides: "Skip to main content link"
      exports: ["SkipToContent"]
    - path: "frontend/src/hooks/useReducedMotion.ts"
      provides: "Hook for prefers-reduced-motion media query"
      exports: ["useReducedMotion"]
  key_links:
    - from: "frontend/src/App.tsx"
      to: "LiveRegions, SkipToContent"
      via: "rendered as first children in app"
      pattern: "<SkipToContent|<LiveRegions"
    - from: "frontend/src/utils/announce.ts"
      to: "frontend/src/store/announcementStore.ts"
      via: "setState calls"
      pattern: "useAnnouncementStore\\.setState"
    - from: "frontend/src/features/game/components/LearnMoreModal.tsx"
      to: "focus-trap-react"
      via: "FocusTrap wrapper"
      pattern: "FocusTrap"
---

<objective>
Set up the accessibility foundation for Phase 7: install new dependencies, create the ARIA live region announcement system, add skip-to-content link, implement custom game-show themed focus rings, add focus-trap to modals, and create the useReducedMotion hook.

Purpose: This foundation enables all subsequent accessibility work (keyboard nav, screen reader announcements, celebrations respecting motion preferences).
Output: Working announcement system, skip link, focus rings, focus-trapped modals, and reduced motion hook.
</objective>

<execution_context>
@C:\Users\Chris\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Chris\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@C:\Project Test\.planning\PROJECT.md
@C:\Project Test\.planning\ROADMAP.md
@C:\Project Test\.planning\STATE.md
@C:\Project Test\.planning\phases\07-polish-performance\07-RESEARCH.md
@C:\Project Test\.planning\phases\07-polish-performance\07-CONTEXT.md

Key existing files:
@C:\Project Test\frontend\src\App.tsx
@C:\Project Test\frontend\src\index.css
@C:\Project Test\frontend\src\features\game\components\LearnMoreModal.tsx
@C:\Project Test\frontend\src\shared\components\ConfirmDialog.tsx
@C:\Project Test\frontend\tailwind.config.js
@C:\Project Test\frontend\package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and create announcement system</name>
  <files>
    frontend/package.json
    frontend/src/store/announcementStore.ts
    frontend/src/utils/announce.ts
    frontend/src/components/accessibility/LiveRegions.tsx
    frontend/src/hooks/useReducedMotion.ts
  </files>
  <action>
    1. Install new dependencies from the frontend directory:
       ```
       npm install focus-trap-react react-canvas-confetti web-vitals
       npm install --save-dev eslint-plugin-jsx-a11y
       ```
       Note: Do NOT install react-use or @axe-core/react (not needed yet).

    2. Create `frontend/src/store/announcementStore.ts`:
       - Zustand store with `politeMessage: string` and `assertiveMessage: string` fields
       - Both default to empty string
       - Export `useAnnouncementStore`

    3. Create `frontend/src/utils/announce.ts`:
       - Import `useAnnouncementStore` from the store
       - Export `announce` object with two methods:
         - `polite(message: string)`: Sets politeMessage via setState, clears after 1000ms with setTimeout
         - `assertive(message: string)`: Sets assertiveMessage via setState, clears after 1000ms with setTimeout
       - The clear-then-set pattern ensures screen readers detect text changes for repeated announcements

    4. Create `frontend/src/components/accessibility/LiveRegions.tsx`:
       - Import `useAnnouncementStore`
       - Render two persistent divs:
         - `role="status"` with `aria-live="polite"` and `aria-atomic="true"` and `className="sr-only"` displaying `politeMessage`
         - `role="alert"` with `aria-live="assertive"` and `aria-atomic="true"` and `className="sr-only"` displaying `assertiveMessage`
       - These must be mounted once and persist in the DOM permanently

    5. Create `frontend/src/hooks/useReducedMotion.ts`:
       - Use `window.matchMedia('(prefers-reduced-motion: reduce)')` to detect preference
       - Listen for changes with `addEventListener('change', ...)` and clean up on unmount
       - Return boolean `prefersReducedMotion`
  </action>
  <verify>
    Run `cd frontend && npm run build` to verify TypeScript compilation succeeds with new files and dependencies.
  </verify>
  <done>
    Zustand announcement store exists with polite/assertive messages. announce.ts helper can trigger announcements. LiveRegions component renders two sr-only ARIA live regions. useReducedMotion hook detects prefers-reduced-motion. All new dependencies installed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add skip-to-content link and custom focus rings</name>
  <files>
    frontend/src/components/accessibility/SkipToContent.tsx
    frontend/src/App.tsx
    frontend/src/index.css
    frontend/src/tailwind.config.js
  </files>
  <action>
    1. Create `frontend/src/components/accessibility/SkipToContent.tsx`:
       - Render an anchor `<a href="#main-content" className="skip-link">Skip to main content</a>`
       - Styled to be visually hidden off-screen, but on :focus shows as a fixed element at top-left
       - Uses teal background (#14b8a6), black text, rounded corners, z-index 9999

    2. Update `frontend/src/index.css` (currently just 3 Tailwind directives):
       Add after the @tailwind directives:

       ```css
       /* Screen reader only - visually hidden but accessible */
       .sr-only {
         position: absolute;
         width: 1px;
         height: 1px;
         padding: 0;
         margin: -1px;
         overflow: hidden;
         clip: rect(0, 0, 0, 0);
         white-space: nowrap;
         border-width: 0;
       }

       /* Skip to content link */
       .skip-link {
         position: absolute;
         left: -9999px;
         top: auto;
         width: 1px;
         height: 1px;
         overflow: hidden;
         z-index: 9999;
       }

       .skip-link:focus {
         position: fixed;
         top: 10px;
         left: 10px;
         width: auto;
         height: auto;
         padding: 0.5rem 1rem;
         background: #14b8a6;
         color: #000;
         border-radius: 0.25rem;
         text-decoration: none;
         font-weight: 600;
         box-shadow: 0 0 0 3px #fff, 0 0 0 5px #14b8a6;
       }

       /* Custom focus rings - teal glow for game-show theme */
       *:focus-visible {
         outline: none;
         box-shadow:
           0 0 0 3px hsl(222 47% 11%),
           0 0 0 5px #14b8a6,
           0 0 15px rgba(20, 184, 166, 0.4);
       }

       /* Amber focus ring for primary action buttons */
       .focus-ring-primary:focus-visible {
         outline: none;
         box-shadow:
           0 0 0 3px hsl(222 47% 11%),
           0 0 0 5px #f59e0b,
           0 0 15px rgba(245, 158, 11, 0.4);
       }

       /* Inputs get subtler focus ring */
       input:focus-visible,
       textarea:focus-visible,
       select:focus-visible {
         outline: none;
         box-shadow:
           0 0 0 2px #14b8a6,
           0 0 8px rgba(20, 184, 166, 0.3);
       }

       /* Range input focus - handled by thumb styles */
       input[type="range"]:focus-visible {
         box-shadow: none;
       }

       /* Respect reduced motion */
       @media (prefers-reduced-motion: reduce) {
         *:focus-visible {
           box-shadow:
             0 0 0 3px hsl(222 47% 11%),
             0 0 0 5px #14b8a6;
         }
         .focus-ring-primary:focus-visible {
           box-shadow:
             0 0 0 3px hsl(222 47% 11%),
             0 0 0 5px #f59e0b;
         }
       }
       ```

    3. Update `frontend/src/App.tsx`:
       - Import SkipToContent and LiveRegions
       - Add SkipToContent as the FIRST element inside BrowserRouter (before AuthInitializer)
       - Add LiveRegions immediately after SkipToContent (must be mounted permanently)
       - Wrap the Routes in a `<main id="main-content" tabIndex={-1}>` element
         - tabIndex={-1} allows programmatic focus but keeps it out of tab order
       - Keep AuthInitializer wrapping everything including main

       Structure should be:
       ```tsx
       <BrowserRouter>
         <SkipToContent />
         <LiveRegions />
         <AuthInitializer>
           <main id="main-content" tabIndex={-1}>
             <Routes>...</Routes>
           </main>
         </AuthInitializer>
       </BrowserRouter>
       ```

    4. No changes needed to tailwind.config.js for now (the focus rings are pure CSS).
  </action>
  <verify>
    Run `cd frontend && npm run build` to verify compilation. The build should succeed with SkipToContent and LiveRegions integrated into App.tsx.
  </verify>
  <done>
    Skip-to-content link is first focusable element in app. ARIA live regions are permanently mounted. All interactive elements get custom teal glow focus rings via :focus-visible. Primary action buttons can use focus-ring-primary for amber glow. Range inputs excluded from general focus ring (handled by existing thumb styles). Reduced motion users get simpler focus rings without glow animation.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add focus-trap to modals</name>
  <files>
    frontend/src/features/game/components/LearnMoreModal.tsx
    frontend/src/shared/components/ConfirmDialog.tsx
  </files>
  <action>
    1. Update `frontend/src/features/game/components/LearnMoreModal.tsx`:
       - Import FocusTrap from 'focus-trap-react'
       - Wrap the DialogPanel content inside a FocusTrap component:
         ```tsx
         <FocusTrap focusTrapOptions={{
           initialFocus: false, // Let headlessui Dialog handle initial focus
           escapeDeactivates: true,
           clickOutsideDeactivates: true,
           returnFocusOnDeactivate: true,
         }}>
         ```
       - The LearnMoreModal already uses @headlessui/react Dialog which has some focus management, but FocusTrap provides more robust Tab/Shift+Tab cycling
       - Place FocusTrap inside the AnimatePresence/Dialog structure, wrapping DialogPanel
       - Add `role="dialog"` and `aria-modal="true"` attributes to DialogPanel if not already present (Dialog from headlessui already handles this, verify)
       - Ensure close button has `aria-label="Close modal"` (update from current "Close")

    2. Update `frontend/src/shared/components/ConfirmDialog.tsx`:
       - Import FocusTrap from 'focus-trap-react'
       - Wrap the dialog content div (the bg-slate-800 container) inside a FocusTrap:
         ```tsx
         <FocusTrap focusTrapOptions={{
           initialFocus: false, // Let AnimatePresence settle first
           escapeDeactivates: false, // Already has cancel behavior
           clickOutsideDeactivates: true,
           returnFocusOnDeactivate: true,
         }}>
         ```
       - Place FocusTrap around the inner dialog content (the slate-800 box), inside the z-50 fixed container
       - ConfirmDialog already has `role="dialog"` and `aria-modal="true"` -- good
       - Add `aria-describedby="dialog-message"` to the dialog container and `id="dialog-message"` to the message paragraph

    Important: The FocusTrap must only render when the modal is actually open/visible. Both components already conditionally render (ConfirmDialog via AnimatePresence isOpen check, LearnMoreModal via AnimatePresence isOpen check), so this is handled.
  </action>
  <verify>
    Run `cd frontend && npm run build` to verify compilation with focus-trap-react integration in both modals.
  </verify>
  <done>
    LearnMoreModal traps Tab/Shift+Tab focus within its content and returns focus to trigger element on close. ConfirmDialog traps focus within its buttons and returns focus on close. Both modals have proper ARIA attributes (role=dialog, aria-modal, aria-labelledby, aria-describedby).
  </done>
</task>

</tasks>

<verification>
- `cd frontend && npm run build` succeeds
- SkipToContent, LiveRegions imported and rendered in App.tsx
- announce.polite() and announce.assertive() functions exist and update Zustand store
- FocusTrap wraps both LearnMoreModal and ConfirmDialog
- Custom focus rings defined in index.css with :focus-visible
- useReducedMotion hook exists and detects motion preference
</verification>

<success_criteria>
- All 4 new dependencies installed (focus-trap-react, react-canvas-confetti, web-vitals, eslint-plugin-jsx-a11y)
- ARIA live regions render in DOM (two sr-only divs with aria-live)
- Skip-to-content link is first focusable element, styled with teal bg on focus
- Custom focus rings (teal glow) apply to all interactive elements via :focus-visible
- Both modals have focus-trap cycling and proper ARIA attributes
- useReducedMotion hook correctly reads prefers-reduced-motion preference
- Frontend builds without TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/07-polish-performance/07-01-SUMMARY.md`
</output>
