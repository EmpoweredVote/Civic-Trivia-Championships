---
phase: 27-backend-foundation-inline-flagging
plan: 03
type: execute
wave: 3
depends_on: ["27-01", "27-02"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Full flag lifecycle works end-to-end: flag during reveal, see on results, persists in database"
    - "Anonymous play has no flag button visible"
    - "Rate limiting activates after 10 flags in 15 minutes"
    - "Tap-anywhere-to-advance still works everywhere except flag icon"
  artifacts: []
  key_links: []
---

<objective>
Verify the complete flagging feature works end-to-end: authenticated play with flagging, anonymous play without flag button, toggle behavior, rate limiting, and results screen display.

Purpose: Visual and functional verification that the flag button design matches user decisions (amber fill, tooltip, positioning) and all game flow behaviors are preserved.
Output: Verified working feature ready for Phase 28 (post-game elaboration).
</objective>

<execution_context>
@C:\Users\Chris\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Chris\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/27-backend-foundation-inline-flagging/27-01-SUMMARY.md
@.planning/phases/27-backend-foundation-inline-flagging/27-02-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete question flagging system: database infrastructure (question_flags table, flag_count column), backend API (POST/DELETE /api/feedback/flag with rate limiting), and frontend UI (FlagButton on answer reveal screen with amber toggle, results screen flag indicators).
  </what-built>
  <how-to-verify>
Start both backend and frontend dev servers (`cd backend && npm run dev` and `cd frontend && npm run dev`).

**Test 1: Authenticated flag flow**
1. Log in with an account
2. Start a game (any collection)
3. Answer a question — on the reveal screen, look for a small flag icon in the top-right area
4. Tap the flag icon — it should fill with amber/yellow color
5. Hover over the flag icon — tooltip should say "Unflag"
6. Tap the flag icon again — amber should fade out (unflagged)
7. Flag a question and tap "Next Question" — flag icon tap should NOT advance to next question
8. Tap anywhere else on the reveal screen — it SHOULD advance to next question
9. Flag 2-3 questions during the game
10. On the results screen, verify flagged questions show a small amber flag icon

**Test 2: Anonymous play (no flag button)**
1. Log out or open incognito/private browser
2. Start a game as anonymous
3. Answer a question — on the reveal screen, verify NO flag icon is visible
4. Tap anywhere to advance — game flow works normally

**Test 3: Toggle persistence**
1. Log in, start a game
2. Flag a question, then advance to next question
3. Complete the game
4. Check results screen — the flagged question should show amber flag indicator

**Test 4: Visual design check**
1. Flag icon is small and unobtrusive (utility feel, not primary action)
2. Amber/yellow color matches existing game palette
3. Tooltip appears on hover with correct text
4. Flag icon does not overlap with other UI elements (timer, score, Learn More)
  </how-to-verify>
  <resume-signal>Type "approved" if all tests pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
Human verification of end-to-end flagging feature across authenticated and anonymous flows.
</verification>

<success_criteria>
- User confirms: authenticated flag flow works (flag, unflag, amber toggle, results display)
- User confirms: anonymous play has no flag button
- User confirms: tap-anywhere-to-advance preserved (flag icon excluded)
- User confirms: visual design matches expectations (small, unobtrusive, amber color)
</success_criteria>

<output>
After completion, create `.planning/phases/27-backend-foundation-inline-flagging/27-03-SUMMARY.md`
</output>
