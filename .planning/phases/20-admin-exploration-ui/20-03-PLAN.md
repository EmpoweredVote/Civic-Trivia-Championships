---
phase: 20-admin-exploration-ui
plan: 03
type: execute
wave: 2
depends_on: ["20-01"]
files_modified:
  - frontend/src/pages/admin/CollectionsPage.tsx
  - frontend/src/pages/admin/components/CollectionCard.tsx
  - frontend/src/pages/admin/components/ProgressBar.tsx
  - frontend/src/pages/admin/AdminDashboard.tsx
  - frontend/src/App.tsx
autonomous: false

must_haves:
  truths:
    - "Admin can view a grid of collection cards showing summary stats (question count, avg quality score, difficulty distribution, telemetry)"
    - "Collection cards use color-coded health indicators (red/yellow/green) based on question count and quality thresholds"
    - "Admin can click a collection card to expand full detail with progress bars and breakdowns"
    - "Admin can click through from collection health to question table pre-filtered by that collection"
    - "Admin dashboard landing page shows summary overview with high-level stats and links to drill into questions and collections"
    - "Collections route is wired at /admin/collections"
  artifacts:
    - path: "frontend/src/pages/admin/CollectionsPage.tsx"
      provides: "Collection health dashboard page"
      min_lines: 80
    - path: "frontend/src/pages/admin/components/CollectionCard.tsx"
      provides: "Collection summary card with expandable detail"
      min_lines: 50
    - path: "frontend/src/pages/admin/components/ProgressBar.tsx"
      provides: "Reusable progress bar visualization"
      min_lines: 20
    - path: "frontend/src/pages/admin/AdminDashboard.tsx"
      provides: "Updated admin dashboard with live stats overview"
      min_lines: 60
  key_links:
    - from: "frontend/src/pages/admin/CollectionsPage.tsx"
      to: "/api/admin/collections/health"
      via: "fetch on mount"
      pattern: "fetch.*admin/collections/health"
    - from: "frontend/src/pages/admin/components/CollectionCard.tsx"
      to: "frontend/src/pages/admin/QuestionsPage.tsx"
      via: "Link to /admin/questions?collection={slug}"
      pattern: "to=.*admin/questions.*collection"
    - from: "frontend/src/App.tsx"
      to: "frontend/src/pages/admin/CollectionsPage.tsx"
      via: "React Router nested route under /admin"
      pattern: "Route.*collections.*CollectionsPage"
---

<objective>
Build the collection health dashboard and update the admin dashboard landing page with live stats. Collection cards show summary metrics with progressive disclosure, color-coded health indicators, and click-through to the question explorer.

Purpose: EXPL-03 (collection health dashboard) and enhanced admin overview. Completes the admin exploration UI alongside Plan 02's question explorer.
Output: CollectionsPage with health cards, ProgressBar component, updated AdminDashboard with live stats, and route wiring.
</objective>

<execution_context>
@C:\Users\Chris\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Chris\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/20-admin-exploration-ui/20-CONTEXT.md
@.planning/phases/20-admin-exploration-ui/20-RESEARCH.md
@.planning/phases/20-admin-exploration-ui/20-01-SUMMARY.md

# Existing admin pages
@frontend/src/pages/admin/AdminLayout.tsx
@frontend/src/pages/admin/AdminDashboard.tsx
@frontend/src/App.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Collection health dashboard with expandable cards and progress bars</name>
  <files>
    frontend/src/pages/admin/CollectionsPage.tsx
    frontend/src/pages/admin/components/CollectionCard.tsx
    frontend/src/pages/admin/components/ProgressBar.tsx
    frontend/src/App.tsx
  </files>
  <action>
**1. Create ProgressBar component** at `frontend/src/pages/admin/components/ProgressBar.tsx`:
- Props: `{ value: number; max: number; label?: string; color?: 'green' | 'yellow' | 'red' | 'gray' }`
- Renders a horizontal bar with Tailwind: gray bg track (rounded-full h-2.5), colored fill bar with width as percentage
- If label provided: render label text and "value/max" above the bar
- Color maps: green -> bg-green-600, yellow -> bg-yellow-500, red -> bg-red-600, gray -> bg-gray-400
- Percentage clamped 0-100: `Math.min(100, Math.max(0, (value / max) * 100))`
- Smooth transition on width change: `transition-all duration-300`

**2. Create CollectionCard component** at `frontend/src/pages/admin/components/CollectionCard.tsx`:

Props: the collection stats object from the /api/admin/collections/health response.

Define a TypeScript interface for the stats shape:
```typescript
interface CollectionHealth {
  id: number;
  name: string;
  slug: string;
  isActive: boolean;
  themeColor: string;
  stats: {
    activeCount: number;
    archivedCount: number;
    totalCount: number;
    difficulty: { easy: number; medium: number; hard: number };
    quality: { avgScore: number | null; minScore: number | null; unscoredCount: number };
    telemetry: { totalEncounters: number; totalCorrect: number; overallCorrectRate: number | null };
  };
}
```

**Card layout (collapsed -- default):**
- Card with white bg, rounded-lg, border, shadow-sm, hover:shadow-md transition
- Left color bar (4px) using collection's themeColor
- Header: collection name (bold), active/inactive badge
- Health indicator dot: compute health status based on thresholds:
  - Red: activeCount < 50 (below minimum per Phase 19 decision) OR avgScore < 50
  - Yellow: activeCount < 80 OR avgScore < 70
  - Green: activeCount >= 80 AND avgScore >= 70
  - Gray: no scored questions (avgScore is null)
- Summary row: active count, avg quality score, overall correct rate (or "N/A")
- "View Questions" link: `<Link to={/admin/questions?collection=${slug}}>` -- click-through to question table pre-filtered by this collection (per CONTEXT.md)
- Click card area (not the link) to expand detail

**Card layout (expanded -- below card, progressive disclosure per CONTEXT.md):**
- Expanded section appears below the card with slide-down animation (simple CSS transition or conditional render)
- **Question Count section:** ProgressBar showing activeCount / target (use 100 as aspirational target), label "Active Questions"
- **Difficulty Distribution:** Three ProgressBars (easy/medium/hard) stacked, each showing count / activeCount, color-coded (green/yellow/red)
- **Quality Scores:** ProgressBar for avgScore / 100, label "Avg Quality Score". Text showing min score and unscored count.
- **Telemetry:** Total encounters, total correct, overall correct rate percentage. If overallCorrectRate is null, show "No data yet"
- **Archived count** shown as small text: "N archived questions"

**3. Create CollectionsPage** at `frontend/src/pages/admin/CollectionsPage.tsx`:
- On mount: fetch `GET /api/admin/collections/health` with auth token
- State: collections array (CollectionHealth[]), loading, error, expandedId (number | null -- which card is expanded)
- Loading state: grid of skeleton cards (animate-pulse)
- Error state: red error banner with retry button
- Page header: "Collection Health" title with subtitle showing total active collections count
- Grid layout: `grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6`
- Render CollectionCard for each collection, passing stats and expanded state
- Click card toggles expandedId (click same card collapses, click different card switches)

**4. Wire route in App.tsx** (add alongside the questions route from Plan 02):
- Import CollectionsPage from `./pages/admin/CollectionsPage`
- Add route: `<Route path="collections" element={<CollectionsPage />} />`
- This goes under the AdminLayout route, alongside the questions route

NOTE: App.tsx will be modified by both Plan 02 and Plan 03. Plan 02 adds the questions route. Plan 03 adds the collections route. If Plan 02 has already run, read the current App.tsx first and add the collections route alongside the existing questions route. If Plan 02 has NOT run yet, add both routes (questions placeholder comment can remain).
  </action>
  <verify>
```
cd frontend && npx tsc --noEmit && npm run build
```
Build succeeds. Verify CollectionsPage route exists in App.tsx. Verify CollectionCard.tsx and ProgressBar.tsx exist.
  </verify>
  <done>
CollectionsPage at /admin/collections shows grid of collection health cards with color-coded health indicators. Cards show summary stats (question count, avg quality, correct rate). Clicking a card expands full detail with progress bars for difficulty distribution, quality scores, and telemetry. "View Questions" link navigates to /admin/questions?collection={slug} for click-through filtering.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update admin dashboard with live stats overview</name>
  <files>
    frontend/src/pages/admin/AdminDashboard.tsx
  </files>
  <action>
Replace the current placeholder dashboard (which shows "coming soon" cards) with a live summary overview.

**Rewrite AdminDashboard.tsx:**

On mount: fetch `GET /api/admin/collections/health` with auth token (reuse the same endpoint -- it has all the stats we need for the overview).

**Layout:**

1. **Welcome section** (keep existing): "Welcome, {name}" header

2. **Stats overview row** (new): 4 stat cards in a horizontal row (`grid grid-cols-2 lg:grid-cols-4 gap-4`)
   - Total Active Questions: sum of all collection activeCount values. White card, large number, small label.
   - Total Collections: count of collections where isActive is true. White card, large number, small label.
   - Avg Quality Score: weighted average of avgScore across collections (or simple average if all collections have scores). White card, number with color indicator.
   - Overall Correct Rate: sum of totalCorrect / sum of totalEncounters across all collections. White card, percentage.

3. **Collections needing attention** (new): List collections with health status red or yellow. For each:
   - Collection name with health indicator dot
   - Brief reason: "Only N active questions" or "Low quality score (N)"
   - Link to `/admin/collections` to investigate
   - If none need attention: green success message "All collections healthy"

4. **Quick links section** (new, replaces the old "upcoming features" cards):
   - "Question Explorer" card with link to `/admin/questions` -- "Browse, filter, and inspect all questions"
   - "Collection Health" card with link to `/admin/collections` -- "Monitor question counts and quality"
   - Styled as clickable cards with red accent, icon, and description

Remove the old "Coming in Phase 20/21" placeholder cards. Remove the "Legacy Content Review" notice. These are no longer relevant -- the features are now live.

Keep the "Content Generation - Coming in Phase 21" card (still future).

Use auth token from useAuthStore for the API fetch.
  </action>
  <verify>
```
cd frontend && npx tsc --noEmit && npm run build
```
Build succeeds. Verify AdminDashboard.tsx no longer contains "Coming in Phase 20" text. Verify it imports and uses fetch for /api/admin/collections/health.
  </verify>
  <done>
Admin dashboard at /admin shows live summary stats (total questions, collections, avg quality, correct rate), collections needing attention list, and quick links to Question Explorer and Collection Health. Placeholder "coming soon" cards replaced with live data and navigation.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Collection health dashboard with expandable cards, progress bars, click-through to filtered question table, and updated admin dashboard with live stats</what-built>
  <how-to-verify>
1. Start backend and frontend dev servers
2. Log in as an admin user
3. Navigate to /admin -- verify dashboard shows live stats (total questions, collections, quality score, correct rate)
4. Verify: Collections needing attention section shows any collections with low question count or quality
5. Verify: Quick links to "Question Explorer" and "Collection Health" are clickable
6. Click "Collection Health" link or navigate to /admin/collections
7. Verify: Grid of collection cards appears with health indicator dots (red/yellow/green)
8. Verify: Each card shows collection name, active question count, avg quality score, correct rate
9. Verify: Click a card to expand -- shows progress bars for difficulty distribution, quality scores, telemetry
10. Verify: "View Questions" link on card navigates to /admin/questions?collection={slug} -- table shows questions filtered to that collection
11. Verify: Click a different card -- previous card collapses, new one expands
12. Verify: Sidebar navigation links (Dashboard, Questions, Collections) all work correctly
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. `cd frontend && npm run build` -- production build succeeds
2. /admin shows live summary dashboard (not placeholders)
3. /admin/collections shows collection health cards with expandable detail
4. Click-through from collection card to question table with collection filter works
5. Progress bars render correctly for all metrics
6. Health indicators use correct color thresholds
7. All three admin sidebar nav links route correctly
</verification>

<success_criteria>
- CollectionsPage at /admin/collections displays health dashboard with expandable cards (EXPL-03)
- Cards show question counts, difficulty distribution, quality scores, telemetry aggregates (EXPL-03)
- Color-coded health indicators on cards (CONTEXT.md decision)
- Click-through from collection to pre-filtered question table (CONTEXT.md decision)
- Admin dashboard shows live summary stats replacing placeholder cards
- Human verification confirms visual and functional correctness
</success_criteria>

<output>
After completion, create `.planning/phases/20-admin-exploration-ui/20-03-SUMMARY.md`
</output>
