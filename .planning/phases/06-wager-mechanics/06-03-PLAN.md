---
phase: 06-wager-mechanics
plan: 03
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - frontend/src/features/game/components/ResultsScreen.tsx
autonomous: true

must_haves:
  truths:
    - "Results screen shows a dedicated wager breakdown section when a wager was placed"
    - "Wager section shows bet amount, whether user won or lost, and points gained/lost"
    - "Score animation counts to the correct final total (including wager result)"
    - "Q10 answer review shows wager info instead of base+speed breakdown"
    - "Results screen works normally when no wager was placed (wager of 0 or no wager data)"
  artifacts:
    - path: "frontend/src/features/game/components/ResultsScreen.tsx"
      provides: "Wager breakdown section in results and wager-aware Q10 answer review"
      contains: "wagerResult"
  key_links:
    - from: "frontend/src/features/game/components/ResultsScreen.tsx"
      to: "frontend/src/types/game.ts"
      via: "GameResult.wagerResult field"
      pattern: "wagerResult"
---

<objective>
Add a dedicated wager outcome section to the results screen that shows the bet amount, win/loss status, and points change. Update the Q10 answer review to show wager-specific breakdown instead of base+speed.

Purpose: The results screen is where the "moment of truth" happens -- the dramatic reveal of whether the wager paid off. The wager breakdown should be visually prominent and clearly communicate the outcome separate from the standard Q1-Q9 scoring.

Output: Updated ResultsScreen.tsx with wager breakdown section and wager-aware answer review.
</objective>

<execution_context>
@C:\Users\Chris\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Chris\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-wager-mechanics/06-CONTEXT.md
@.planning/phases/06-wager-mechanics/06-01-SUMMARY.md
@frontend/src/features/game/components/ResultsScreen.tsx
@frontend/src/types/game.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wager breakdown section in results screen</name>
  <files>
    frontend/src/features/game/components/ResultsScreen.tsx
  </files>
  <action>
Modify ResultsScreen.tsx to add a wager outcome section and update the Q10 answer review.

**1. Wager Breakdown Section (new, placed between the score breakdown and accuracy display):**

Check if `result.wagerResult` exists and `result.wagerResult.wagerAmount > 0`. If so, render a dedicated wager section:

```
Layout:
- Rounded card with special styling:
  - Won: bg-gradient-to-r from-green-500/10 to-teal-500/10, border border-green-500/40
  - Lost: bg-gradient-to-r from-red-500/10 to-orange-500/10, border border-red-500/40
- Inside the card:
  - Header: "Final Question Wager" (text-lg font-bold text-white)
  - Wager amount: "Bet: {wagerAmount} points" (text-slate-300)
  - Outcome with icon:
    - Won: green checkmark icon + "Won! +{wagerAmount}" in text-green-400 text-2xl font-bold
    - Lost: red X icon + "Lost -|wagerAmount|" in text-red-400 text-2xl font-bold
  - Entrance animation: motion.div with initial={{ opacity: 0, y: 20 }}, animate, delay 0.25s (after score)
```

**2. Score Breakdown Update:**

The existing score breakdown line shows: `{totalBasePoints} base + {totalSpeedBonus} speed`

When a wager was placed, extend this to also show the wager impact:
- Calculate base+speed from Q1-Q9 only: `const q1to9BasePoints = result.answers.slice(0, 9).reduce((sum, a) => sum + a.basePoints, 0)` and `const q1to9SpeedBonus = result.answers.slice(0, 9).reduce((sum, a) => sum + a.speedBonus, 0)`
- If wagerResult exists and wagerAmount > 0:
  - Show: `{q1to9BasePoints} base + {q1to9SpeedBonus} speed {wagerResult.won ? '+' : '-'} {wagerResult.wagerAmount} wager`
  - Color the wager part green (won) or red (lost)
- If no wager or wager is 0: show original breakdown unchanged

**3. Q10 Answer Review Update:**

In the question review section, the expanded view for Q10 (index 9) should show wager-specific info instead of the standard base+speed breakdown:

- Check if `index === 9 && answer.wager !== undefined && answer.wager > 0`
- Instead of showing "Base: +X | Speed: +Y | Time: Zs", show:
  - "Wager: {answer.wager} points"
  - If correct: "+{answer.wager}" in green
  - If incorrect/timeout: "-{answer.wager}" in red
  - Still show response time: "Time: {answer.responseTime.toFixed(1)}s"
- The points badge (collapsed view) for Q10 should handle negative totalPoints:
  - Currently shows `+{answer.totalPoints}` -- update to handle negatives:
  - If `answer.totalPoints >= 0`: show `+{answer.totalPoints}` in teal (existing)
  - If `answer.totalPoints < 0`: show `{answer.totalPoints}` (already has minus sign) in red (text-red-400)
- If Q10 had 0 wager: show "Wager: 0 (played for fun)" in slate text, and "0 points" for the outcome

**4. Dramatic Score Count Animation:**

The existing score animation counts from 0 to totalScore. With a wager loss, totalScore could be lower than the pre-wager score. The spring animation handles this naturally (it counts to whatever value you give it), but ensure the animation target is `result.totalScore` which already includes the wager result. No change needed to the animation itself -- just verify it works with values that could be lower than expected.

**5. Edge Cases:**
- No wager data (wagerResult is null/undefined): render existing results screen unchanged
- Wager of 0: show the wager section but with "Played for Fun" message instead of won/lost
- Negative totalScore (rare but possible if they had very low score and lost wager): display negative score correctly. The toLocaleString() handles this. Update the color: if totalScore < 0, use text-red-400 instead of text-teal-400.

Avoid: Do NOT add a separate animated counter for the wager reveal -- the existing totalScore animation already counts to the final value (which includes wager). The drama comes from the number going higher or lower than expected, which the spring animation naturally conveys. Do NOT restructure the existing ResultsScreen -- add the wager section inline with existing structure.
  </action>
  <verify>
Run `npx tsc --noEmit` from frontend/. Verify the ResultsScreen renders correctly by playing a game with a wager and checking: (1) wager breakdown section appears, (2) Q10 review shows wager instead of base+speed, (3) negative points display correctly, (4) score breakdown line includes wager. Also test with 0 wager and with no wager (anonymous user might not have wager data).
  </verify>
  <done>
Results screen shows dedicated wager breakdown section with win/loss styling. Score breakdown includes wager impact. Q10 answer review shows wager-specific info. Negative totalPoints display correctly in red. 0-wager shows "Played for Fun". No-wager games render existing results unchanged.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes in frontend/
2. Play a game, wager 200 points, answer Q10 correctly: results show "+200" wager section in green, score breakdown includes "+ 200 wager"
3. Play a game, wager 200 points, answer Q10 incorrectly: results show "-200" wager section in red, score breakdown includes "- 200 wager"
4. Play a game, slide wager to 0, answer Q10: results show "Played for Fun" in wager section
5. Play a game where all Q1-Q9 wrong (score 0), wager 0: results display normally with 0 total
6. Q10 in answer review shows "Wager: X points" instead of "Base: +100 | Speed: +50"
7. Q10 points badge shows red negative when wager lost
8. Existing results screen layout for Q1-Q9 is completely unchanged
</verification>

<success_criteria>
- Wager breakdown section appears between score and accuracy when wagerAmount > 0
- Win shows green styling with checkmark, loss shows red styling with X
- Score breakdown line includes wager component colored by outcome
- Q10 answer review shows wager info, not base+speed
- Negative totalPoints and totalScore display correctly
- Zero wager shows "Played for Fun"
- No wager data = existing results screen unchanged
- All TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/06-wager-mechanics/06-03-SUMMARY.md`
</output>
