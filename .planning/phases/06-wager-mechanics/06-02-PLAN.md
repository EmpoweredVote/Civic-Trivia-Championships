---
phase: 06-wager-mechanics
plan: 02
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - frontend/src/features/game/components/FinalQuestionAnnouncement.tsx
  - frontend/src/features/game/components/WagerScreen.tsx
  - frontend/src/features/game/components/GameScreen.tsx
  - frontend/src/pages/Game.tsx
autonomous: true

must_haves:
  truths:
    - "After Q9 reveal auto-advances, a full-screen FINAL QUESTION announcement appears"
    - "Announcement auto-transitions to wager screen after ~2.5s"
    - "Wager screen shows Q10 category hint and slider from 0 to half current score"
    - "Slider defaults to 25% of max wager"
    - "Live outcome preview updates as slider moves (If correct: X / If wrong: Y)"
    - "Button says 'Play for Fun' at 0, 'Lock In Wager' above 0"
    - "Final question plays with 50s timer and distinct visual styling"
    - "Score 0 users see disabled slider with 'Play for Fun' button"
  artifacts:
    - path: "frontend/src/features/game/components/FinalQuestionAnnouncement.tsx"
      provides: "Full-screen animated announcement with dramatic entrance/exit"
      min_lines: 30
    - path: "frontend/src/features/game/components/WagerScreen.tsx"
      provides: "Wager input with slider, outcome preview, context-aware button"
      min_lines: 80
    - path: "frontend/src/features/game/components/GameScreen.tsx"
      provides: "Conditional rendering for new phases, extended timer for Q10"
      contains: "final-announcement"
    - path: "frontend/src/pages/Game.tsx"
      provides: "Passes wager methods from hook to GameScreen"
      contains: "setWagerAmount"
  key_links:
    - from: "frontend/src/features/game/components/GameScreen.tsx"
      to: "frontend/src/features/game/components/FinalQuestionAnnouncement.tsx"
      via: "Conditional render when phase is final-announcement"
      pattern: "final-announcement.*FinalQuestionAnnouncement"
    - from: "frontend/src/features/game/components/GameScreen.tsx"
      to: "frontend/src/features/game/components/WagerScreen.tsx"
      via: "Conditional render when phase is wagering or wager-locked"
      pattern: "wagering.*WagerScreen"
    - from: "frontend/src/features/game/components/WagerScreen.tsx"
      to: "frontend/src/features/game/hooks/useGameState.ts"
      via: "onSetWager and onLockWager callbacks"
      pattern: "onLockWager|onSetWager"
---

<objective>
Build the wager flow UI: full-screen "FINAL QUESTION" announcement, wager input screen with slider and outcome preview, and integrate into GameScreen with final question visual styling and extended timer.

Purpose: This is the core user experience of the wager feature. The announcement creates dramatic tension, the wager screen gives users control over risk, and the final question plays with distinct styling to signal its special status.

Output: Two new components (FinalQuestionAnnouncement.tsx, WagerScreen.tsx) and updated GameScreen.tsx that renders the complete wager flow.
</objective>

<execution_context>
@C:\Users\Chris\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Chris\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-wager-mechanics/06-CONTEXT.md
@.planning/phases/06-wager-mechanics/06-RESEARCH.md
@.planning/phases/06-wager-mechanics/06-01-SUMMARY.md
@frontend/src/features/game/components/GameScreen.tsx
@frontend/src/pages/Game.tsx
@frontend/src/types/game.ts
@frontend/src/features/game/hooks/useGameState.ts
@frontend/src/features/game/components/GameTimer.tsx
@frontend/src/features/game/components/ScoreDisplay.tsx
@frontend/src/features/game/components/AnswerGrid.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: FinalQuestionAnnouncement and WagerScreen components</name>
  <files>
    frontend/src/features/game/components/FinalQuestionAnnouncement.tsx
    frontend/src/features/game/components/WagerScreen.tsx
  </files>
  <action>
**FinalQuestionAnnouncement.tsx:**
Create a full-screen dramatic announcement component. This is a dedicated screen (not an overlay).

Props: `{ show: boolean }` (AnimatePresence handles mount/unmount)

Design:
- Full viewport dark background matching app theme (bg-gradient-to-b from-slate-900 via-slate-800 to-slate-900)
- Centered content with motion animations
- Large "FINAL QUESTION" text (text-5xl md:text-7xl font-bold) in white with a subtle golden/amber glow effect (text-shadow)
- Subtle pulsing animation on the text (scale [1, 1.05, 1] repeating)
- A decorative element: thin horizontal lines or a spotlight gradient above/below the text
- Use AnimatePresence wrapping: initial={{ opacity: 0, scale: 0.8 }}, animate={{ opacity: 1, scale: 1 }}, exit={{ opacity: 0, scale: 1.1 }} with ease-out transition ~0.5s
- Component is purely presentational -- timing is controlled by the hook (2.5s display, then auto-transitions to wager)

**WagerScreen.tsx:**
Create the wager input screen where users choose how much to bet.

Props interface:
```typescript
interface WagerScreenProps {
  currentScore: number;
  category: string;        // Q10 topic category for the hint
  wagerAmount: number;     // Current wager amount from state
  onSetWager: (amount: number) => void;
  onLockWager: () => void;
  isLocked: boolean;       // True during wager-locked phase (disable inputs)
}
```

Layout (full-screen, centered, matching app theme):
- Header section: "Final Question" title (text-3xl), "Category: {category}" hint below in teal text. Use TOPIC_LABELS mapping from TopicIcon.tsx to display the human-readable category name.
- Current score display: "Your Score: {currentScore}" in white
- Slider section:
  - Label: "Wager: {wagerAmount} points" prominently displayed (text-2xl)
  - Native `<input type="range">` with: min=0, max=Math.floor(currentScore/2), value=wagerAmount, step=10, onChange dispatches onSetWager
  - Add `aria-valuetext="{wagerAmount} points"` for accessibility
  - Custom Tailwind styling for the range input: use appearance-none and custom ::-webkit-slider-thumb / ::-moz-range-thumb pseudo-elements via a CSS class or inline styles. Track: h-3 rounded-full bg-slate-700. Thumb: w-6 h-6 rounded-full bg-teal-500 with ring on focus.
  - Min/max labels below slider: "0" on left, "{maxWager}" on right
  - When currentScore is 0: disable the slider, show "No points to wager" message
- Outcome preview section (aria-live="polite"):
  - Two rows showing potential outcomes:
    - "If correct:" followed by `{currentScore + wagerAmount}` in green/teal (text-green-400)
    - "If wrong:" followed by `{currentScore - wagerAmount}` in red (text-red-400)
  - Animate the numbers with a subtle transition when slider moves (no spring needed here, just smooth text updates)
- Action button:
  - When wagerAmount === 0: "Play for Fun" with a more subdued style (border button, not filled)
  - When wagerAmount > 0: "Lock In Wager" with filled teal style (bg-teal-600) matching existing lock-in UX
  - onClick calls onLockWager
  - Disabled when isLocked (during wager-locked suspense phase)
  - Min height 48px for touch targets
- Entrance animation: motion.div with initial={{ opacity: 0, y: 20 }}, animate={{ opacity: 1, y: 0 }}
- When isLocked=true: show a "Locked!" indicator and dim the inputs

Avoid: Do NOT use a third-party slider library. Use native input type="range". Do NOT manage slider state locally -- it comes from props (reducer is source of truth). Do NOT add a separate skip button -- slider at 0 IS the skip.
  </action>
  <verify>
Both files compile: `npx tsc --noEmit` from frontend/. Verify FinalQuestionAnnouncement renders with AnimatePresence pattern. Verify WagerScreen renders slider, outcome preview, and context-aware button text.
  </verify>
  <done>
FinalQuestionAnnouncement shows dramatic full-screen text with entrance/exit animations. WagerScreen shows category hint, slider (0 to half score), live outcome preview, and context-aware button ("Play for Fun" at 0, "Lock In Wager" above 0). Both components use Framer Motion and match the existing dark theme aesthetic.
  </done>
</task>

<task type="auto">
  <name>Task 2: GameScreen integration and Game.tsx wiring</name>
  <files>
    frontend/src/features/game/components/GameScreen.tsx
    frontend/src/pages/Game.tsx
  </files>
  <action>
**Game.tsx:**
- Import and pass additional props from useGameState to GameScreen:
  - `setWagerAmount`, `lockWager`, `isFinalQuestion` (new from hook)
  - `state.wagerAmount`, `state.wagerCategory` are accessible via `state` which is already passed
- Update GameScreenProps usage accordingly

**GameScreen.tsx:**
Add imports for FinalQuestionAnnouncement and WagerScreen at the top.

Update GameScreenProps interface to include:
- `setWagerAmount: (amount: number) => void`
- `lockWager: () => void`
- `isFinalQuestion: boolean`

Add a constant: `const FINAL_QUESTION_DURATION = 50;` (seconds)

Add conditional rendering for the new phases. The rendering logic should be:

1. **phase === 'idle'**: Existing start button (no change)
2. **phase === 'final-announcement'**: Render FinalQuestionAnnouncement full-screen. Do NOT render the normal game HUD (timer, progress, quit). Just the announcement component.
   ```
   if (state.phase === 'final-announcement') {
     return <FinalQuestionAnnouncement show={true} />;
   }
   ```
3. **phase === 'wagering' or 'wager-locked'**: Render WagerScreen full-screen. Do NOT render normal game HUD.
   ```
   if (state.phase === 'wagering' || state.phase === 'wager-locked') {
     return (
       <WagerScreen
         currentScore={state.totalScore}
         category={state.wagerCategory || 'General'}
         wagerAmount={state.wagerAmount}
         onSetWager={setWagerAmount}
         onLockWager={lockWager}
         isLocked={state.phase === 'wager-locked'}
       />
     );
   }
   ```
4. **Normal game phases (answering, selected, locked, revealing)**: Existing game UI, BUT with two modifications for the final question:
   - **Timer duration**: Pass `isFinalQuestion ? FINAL_QUESTION_DURATION : QUESTION_DURATION` as the `duration` prop to GameTimer
   - **Final question visual styling**: When `isFinalQuestion` is true, add distinct styling to the game screen:
     - Add a golden/amber border glow around the question card area: wrap the question section in a div with `border border-amber-500/40 shadow-[0_0_30px_rgba(245,158,11,0.15)] rounded-xl p-1`
     - Add a "FINAL QUESTION" badge above the question card: small pill badge with `bg-amber-500/20 text-amber-400 border border-amber-500/40 px-3 py-1 rounded-full text-sm font-bold`
     - The timer ring will naturally show 50s instead of 25s due to the duration prop change
   - **Disable score popup on final question**: The ScorePopup showing base+speed doesn't make sense for wager-only scoring. When `isFinalQuestion`, skip showing the ScorePopup during reveal phase.
   - **responseTime calculation in the QUESTION_DURATION constant**: Note that the lock-in and timeout handlers in useGameState already handle the 50s duration. The `currentTimeRemaining` state variable tracks the actual time from GameTimer, so it will correctly reflect the 50s timer.

Important integration details:
- The `timerKey` state must increment when transitioning from wager-locked to answering (Q10 starts). This happens naturally because `state.currentQuestionIndex` changes drive the AnimatePresence key. But verify the timer resets properly -- if Q10 was already set as currentQuestionIndex during final-announcement, the timerKey may not auto-reset. Add a timerKey reset in an effect watching for the transition TO answering phase when isFinalQuestion is true: `if (state.phase === 'answering' && isFinalQuestion) { setTimerKey(prev => prev + 1); setShowOptions(false); }`. Be careful not to duplicate the existing preview reset logic.
- The question preview (2s before options appear) should still work for Q10. The existing effect handles this.
- Keyboard shortcuts should work during Q10 answering phase (already handled by existing logic).

Avoid: Do NOT create separate components for the final question variant of GameScreen -- just add conditional styling within the existing component. Do NOT change the auto-advance duration for the Q10 reveal -- keep it at 6s like other questions. The wager outcome reveal drama happens in the results screen (Plan 03).
  </action>
  <verify>
Run `npx tsc --noEmit` from frontend/. Start the dev server (`npm run dev` in frontend/), play a full game. After Q9, verify: (1) "FINAL QUESTION" announcement appears, (2) wager screen appears with slider and category, (3) final question plays with 50s timer and amber styling, (4) game completes normally. Test with score of 0 (answer all wrong) to verify disabled wager UI.
  </verify>
  <done>
GameScreen renders FinalQuestionAnnouncement during final-announcement phase. GameScreen renders WagerScreen during wagering/wager-locked phases. Final question has 50s timer, amber glow styling, "FINAL QUESTION" badge. Game.tsx passes wager methods to GameScreen. Full wager flow works end-to-end in the game UI: announcement -> wager -> final question -> reveal -> complete.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes in frontend/
2. Play through a full game: Q1-Q9 play normally, then "FINAL QUESTION" announcement appears
3. Announcement auto-transitions to wager screen showing Q10's category
4. Slider moves from 0 to half of current score, outcome preview updates live
5. Button text changes between "Play for Fun" and "Lock In Wager"
6. After locking wager, Q10 plays with 50s timer and amber/gold visual distinction
7. Answering Q10 correctly adds wager to score, incorrectly subtracts it
8. Timing out on Q10 subtracts wager amount
9. Game completes and reaches results screen
10. With 0 score: wager screen shows disabled slider and "Play for Fun" button
</verification>

<success_criteria>
- FinalQuestionAnnouncement component renders full-screen with dramatic animation
- WagerScreen component has slider, outcome preview, and context-aware button
- GameScreen conditionally renders new phases without breaking existing Q1-Q9 flow
- Final question has extended 50s timer and distinct amber visual styling
- Slider is accessible (native input, aria-valuetext, label)
- All wager methods wired from hook through Game.tsx to GameScreen to components
- Full game playable start to finish with wager flow
</success_criteria>

<output>
After completion, create `.planning/phases/06-wager-mechanics/06-02-SUMMARY.md`
</output>
