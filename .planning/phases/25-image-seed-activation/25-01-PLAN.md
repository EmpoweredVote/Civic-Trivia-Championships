---
phase: 25-image-seed-activation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - backend/src/scripts/export-community.ts
  - backend/src/data/fremont-ca-questions.json
  - backend/src/db/seed/seed-community.ts
  - frontend/public/images/collections/fremont-ca.jpg
autonomous: false

must_haves:
  truths:
    - "Fremont collection card displays a Mission Peak banner image in the collection picker"
    - "Export JSON contains exactly 92 active questions (no drafts)"
    - "Seed script includes Fremont and activates it (isActive: true)"
    - "Collection appears in collection picker alongside Federal, Bloomington, and LA"
  artifacts:
    - path: "frontend/public/images/collections/fremont-ca.jpg"
      provides: "Fremont banner image (Mission Peak)"
      contains: "JPEG image file, 100-300KB"
    - path: "backend/src/data/fremont-ca-questions.json"
      provides: "Exported Fremont question data"
      contains: "92 questions in ExportFile format"
    - path: "backend/src/scripts/export-community.ts"
      provides: "Status-filtered export with Fremont slug"
      contains: "eq(questions.status, 'active')"
    - path: "backend/src/db/seed/seed-community.ts"
      provides: "Seed script with Fremont locale entry"
      contains: "fremont-ca"
  key_links:
    - from: "backend/src/scripts/export-community.ts"
      to: "backend/src/data/fremont-ca-questions.json"
      via: "exportCollection('fremont-ca', ...)"
      pattern: "exportCollection.*fremont-ca"
    - from: "backend/src/db/seed/seed-community.ts"
      to: "backend/src/data/fremont-ca-questions.json"
      via: "LOCALES array references JSON file"
      pattern: "fremont-ca.*fremont-ca-questions.json"
    - from: "frontend/src/features/collections/components/CollectionCard.tsx"
      to: "frontend/public/images/collections/fremont-ca.jpg"
      via: "Convention-based slug.jpg loading"
      pattern: "/images/collections/.*\\.jpg"
---

<objective>
Activate the Fremont, CA collection by adding a Mission Peak banner image, exporting 92 active questions to a seed-ready JSON file, and registering Fremont in the seed script for database activation.

Purpose: This is the final step before Fremont becomes playable. Phase 23 created the collection metadata, Phase 24 generated and curated 92 questions. This plan makes it visible in the collection picker with a branded image and seeds the data for reproducible deployment.

Output: Banner image at correct path, exported JSON data file, modified export and seed scripts ready for production seeding.
</objective>

<execution_context>
@C:\Users\Chris\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Chris\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/25-image-seed-activation/25-CONTEXT.md
@.planning/phases/25-image-seed-activation/25-RESEARCH.md

Key source files:
@backend/src/scripts/export-community.ts
@backend/src/db/seed/seed-community.ts
@backend/src/db/seed/collections.ts
@frontend/src/features/collections/components/CollectionCard.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add status filter to export script, add Fremont, and run export</name>
  <files>
    backend/src/scripts/export-community.ts
    backend/src/data/fremont-ca-questions.json
  </files>
  <action>
Modify `backend/src/scripts/export-community.ts` to:

1. Import `and` from drizzle-orm (currently only imports `eq`). Change line 24 to:
   ```typescript
   import { eq, and } from 'drizzle-orm';
   ```

2. Add status filter to the question query in `exportCollection()`. The `.where()` clause on line 102 currently filters only by collectionId. Change it to filter by BOTH collectionId AND status='active':
   ```typescript
   .where(
     and(
       eq(collectionQuestions.collectionId, collection.id),
       eq(questions.status, 'active')
     )
   );
   ```
   This ensures draft/archived questions are excluded from all exports (critical for Fremont which has 31 draft questions).

3. Add Fremont to the `main()` function's export calls (after line 136):
   ```typescript
   await exportCollection('fremont-ca', 'fremont-ca-questions.json');
   ```

4. Update the script's JSDoc header comment to include fremont-ca in the outputs list.

5. Run the export script against the dev database:
   ```bash
   cd backend && npx tsx src/scripts/export-community.ts
   ```

6. Verify the output: `fremont-ca-questions.json` should contain exactly 92 questions (not 123, which would indicate the status filter is missing). Also verify Bloomington and LA exports still work (they should be unchanged since those collections have no draft questions).
  </action>
  <verify>
Run: `cd backend && node -e "const d=require('./src/data/fremont-ca-questions.json'); console.log('Questions:', d.questions.length, 'Topics:', d.topics.length)"`

Expected output: Questions: 92, Topics: 8

Also verify no draft questions leaked: `cd backend && node -e "const d=require('./src/data/fremont-ca-questions.json'); console.log('All have externalId:', d.questions.every(q => q.externalId))"`
  </verify>
  <done>
fremont-ca-questions.json exists in backend/src/data/ with exactly 92 questions across 8 topic categories. Export script has status='active' filter applied to all collection exports. Bloomington and LA exports unaffected.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add banner image and register Fremont in seed script</name>
  <files>
    frontend/public/images/collections/fremont-ca.jpg
    backend/src/db/seed/seed-community.ts
  </files>
  <action>
**Part A: Banner image**

Find and download a free-use (Creative Commons CC0, public domain, or Unsplash License) photo of Mission Peak in Fremont, CA. Requirements:
- Subject: Mission Peak — the iconic hilltop visible from across Fremont. With or without the summit pole.
- Style: Vibrant, clear day — blue sky, green hills. Bright and inviting, NOT moody or dramatic.
- Orientation: MUST be landscape (wider than tall). The banner displays at 112px height with `object-cover` cropping, so a portrait photo would crop very poorly.
- Source options: Search Unsplash (unsplash.com/s/photos/mission-peak-fremont), Wikimedia Commons, or Openverse (openverse.org). Prefer Unsplash License or CC0 for simplest attribution.

Download the image and optimize it:
- Install Sharp as a dev dependency: `cd backend && npm install sharp --save-dev`
- Create a temporary script to resize/optimize:
  ```typescript
  import sharp from 'sharp';
  await sharp('INPUT_PATH')
    .resize(800, 450, { fit: 'cover', position: 'center' })
    .jpeg({ quality: 85, progressive: true })
    .toFile('../frontend/public/images/collections/fremont-ca.jpg');
  ```
- Target file size: 150-250KB (existing banners range 121-283KB)
- Delete the temp script after use
- Record the source URL in the git commit message for attribution

If Sharp installation is problematic, alternatively use `curl` to download an already-appropriately-sized image and manually verify file size is under 300KB. The key constraint is: JPEG format, landscape orientation, under 300KB, saved as `frontend/public/images/collections/fremont-ca.jpg`.

**Part B: Seed script registration**

Modify `backend/src/db/seed/seed-community.ts` to add Fremont to the LOCALES array (line 53-56). Add the new entry after los-angeles-ca:
```typescript
const LOCALES = [
  { slug: 'bloomington-in', file: 'bloomington-in-questions.json' },
  { slug: 'los-angeles-ca', file: 'los-angeles-ca-questions.json' },
  { slug: 'fremont-ca', file: 'fremont-ca-questions.json' },
];
```

This is the ONLY change needed to seed-community.ts. The script already:
- Looks up the collection by slug (Fremont exists from Phase 23 seed)
- Sets `isActive: true` on the collection (line 83-86)
- Upserts topics and links them to collection
- Inserts questions with `onConflictDoNothing()`

Do NOT run the seed script yet — that will happen in production deployment. The seed script is idempotent and safe to re-run, but running it locally is unnecessary since the questions are already in the dev database from Phase 24.
  </action>
  <verify>
Image verification:
```bash
ls -la frontend/public/images/collections/fremont-ca.jpg
# Should show file exists, size 100-300KB range (100000-300000 bytes)
```

Seed script verification:
```bash
cd backend && node -e "const fs=require('fs'); const content=fs.readFileSync('src/db/seed/seed-community.ts','utf8'); console.log('Has fremont-ca:', content.includes(\"'fremont-ca'\"));  console.log('Has fremont JSON:', content.includes('fremont-ca-questions.json'));"
```

Both should print `true`.
  </verify>
  <done>
fremont-ca.jpg exists at `frontend/public/images/collections/fremont-ca.jpg` as a landscape JPEG under 300KB showing Mission Peak. seed-community.ts LOCALES array includes fremont-ca entry pointing to fremont-ca-questions.json.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Fremont collection activation package:
1. Modified export-community.ts with status='active' filter and Fremont export
2. Exported fremont-ca-questions.json with 92 active questions
3. Added Mission Peak banner image as fremont-ca.jpg
4. Registered Fremont in seed-community.ts LOCALES array
  </what-built>
  <how-to-verify>
1. **Check the banner image**: Open `frontend/public/images/collections/fremont-ca.jpg` in an image viewer. Verify it shows Mission Peak with vibrant colors and looks good cropped to a wide, short banner shape (imagine it 112px tall by ~192px wide).

2. **Test locally** (optional but recommended): Run `cd frontend && npm run dev`, navigate to the collection picker. Fremont card should show:
   - Mission Peak banner image at top
   - "Fremont, CA" title
   - "Five towns, one city -- how well do you know Fremont?" description
   - Emerald green (#047857) theme color visible behind/around image

3. **Verify question data**: Confirm `backend/src/data/fremont-ca-questions.json` exists and has 92 questions (not 123 which would mean drafts leaked through).

4. **Verify seed script**: Confirm `backend/src/db/seed/seed-community.ts` has `fremont-ca` in the LOCALES array.
  </how-to-verify>
  <resume-signal>Type "approved" if the banner image looks good and all files check out. If the image needs adjustment (wrong subject, too dark, poor crop), describe the issue.</resume-signal>
</task>

</tasks>

<verification>
Phase-level checks after all tasks complete:
1. `frontend/public/images/collections/fremont-ca.jpg` exists, is JPEG, 100-300KB, landscape
2. `backend/src/data/fremont-ca-questions.json` has exactly 92 questions across 8 topics
3. `backend/src/scripts/export-community.ts` filters by `status='active'` for all exports
4. `backend/src/db/seed/seed-community.ts` includes fremont-ca in LOCALES array
5. No other files unexpectedly modified
6. All existing collection exports (Bloomington, LA) still function correctly
</verification>

<success_criteria>
- COLL-03: Fremont collection card has a skyline banner image (fremont-ca.jpg) -- banner image committed
- ACTV-01: Collection seedable via community seed script -- fremont-ca in LOCALES, JSON exported
- ACTV-02: Collection will be activated (isActive: true) when seed runs -- seed script auto-activates
- Export script improved with status filter (benefits all future exports, not just Fremont)
</success_criteria>

<output>
After completion, create `.planning/phases/25-image-seed-activation/25-01-SUMMARY.md`
</output>
