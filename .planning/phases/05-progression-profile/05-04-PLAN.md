---
phase: 05-progression-profile
plan: 04
type: execute
wave: 3
depends_on: ["05-02", "05-03"]
files_modified:
  - frontend/src/pages/Profile.tsx
  - frontend/src/components/Avatar.tsx
  - frontend/src/components/layout/Header.tsx
  - frontend/src/App.tsx
  - frontend/src/services/profileService.ts
autonomous: true

must_haves:
  truths:
    - "User can view their profile with total XP and gems"
    - "Profile shows games played, best score, and overall accuracy percentage"
    - "Profile accessible via hamburger menu in header"
    - "Empty state shows encouraging message with CTA to play first game"
    - "Avatar shows initials fallback when no image uploaded"
    - "User can upload avatar image from profile page"
  artifacts:
    - path: "frontend/src/pages/Profile.tsx"
      provides: "Profile page with hero section, stats list, avatar"
      exports: ["Profile"]
    - path: "frontend/src/components/Avatar.tsx"
      provides: "Avatar component with image and initials fallback"
      exports: ["Avatar"]
    - path: "frontend/src/components/layout/Header.tsx"
      provides: "Header with hamburger menu containing Profile link"
      contains: "hamburger|menu|Profile"
    - path: "frontend/src/services/profileService.ts"
      provides: "API service for profile data and avatar upload"
      exports: ["fetchProfile", "uploadAvatar"]
  key_links:
    - from: "frontend/src/pages/Profile.tsx"
      to: "frontend/src/services/profileService.ts"
      via: "fetchProfile on mount"
      pattern: "fetchProfile"
    - from: "frontend/src/components/layout/Header.tsx"
      to: "frontend/src/pages/Profile.tsx"
      via: "React Router Link to /profile"
      pattern: "/profile"
    - from: "frontend/src/App.tsx"
      to: "frontend/src/pages/Profile.tsx"
      via: "Route path=/profile"
      pattern: "Route.*profile"
---

<objective>
Build the user profile page with stats display, avatar (with initials fallback and upload), and add hamburger menu navigation to the header.

Purpose: Users need to see their cumulative progression (PROF-01 through PROF-05). The profile page shows total XP, gems, games played, best score, and accuracy. The hamburger menu provides navigation.

Output: Working profile page accessible from hamburger menu, showing user identity (name + avatar), XP/gems totals, stats list, empty state for new users, and avatar upload capability.
</objective>

<execution_context>
@C:\Users\Chris\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Chris\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@C:\Project Test\.planning\PROJECT.md
@C:\Project Test\.planning\ROADMAP.md
@C:\Project Test\.planning\phases\05-progression-profile\05-CONTEXT.md
@C:\Project Test\.planning\phases\05-progression-profile\05-RESEARCH.md
@C:\Project Test\.planning\phases\05-progression-profile\05-01-SUMMARY.md
@C:\Project Test\.planning\phases\05-progression-profile\05-02-SUMMARY.md
@C:\Project Test\.planning\phases\05-progression-profile\05-03-SUMMARY.md

Key existing files:
@C:\Project Test\frontend\src\components\layout\Header.tsx
@C:\Project Test\frontend\src\App.tsx
@C:\Project Test\frontend\src\store\authStore.ts
@C:\Project Test\frontend\src\services\api.ts
@C:\Project Test\frontend\src\types\auth.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Profile service, Avatar component, and profile page</name>
  <files>
    frontend/src/services/profileService.ts
    frontend/src/components/Avatar.tsx
    frontend/src/pages/Profile.tsx
  </files>
  <action>
    1. Create `frontend/src/services/profileService.ts`:
       - Import `apiRequest` from `./api`
       - Export `ProfileStats` type: `{ totalXp: number, totalGems: number, gamesPlayed: number, bestScore: number, overallAccuracy: number, avatarUrl: string | null, name: string, email: string }`
       - Export `fetchProfile(): Promise<ProfileStats>` - calls GET /api/users/profile with auth header from authStore
       - Export `uploadAvatar(file: File): Promise<{ avatarUrl: string }>`:
         - Create FormData, append file as 'avatar'
         - Use fetch directly (not apiRequest, since we need FormData without Content-Type header â€” browser sets multipart boundary automatically)
         - Include Authorization header from authStore
         - Return the avatarUrl from response

    2. Create `frontend/src/components/Avatar.tsx`:
       - Props: `{ name: string, imageUrl?: string | null, size?: number, onUpload?: (file: File) => void }`
       - If `imageUrl` provided and truthy: render `<img>` with rounded-full, object-cover, proper size
       - If no imageUrl: render initials fallback:
         - Extract up to 2 initials from name (first letter of first and last name parts)
         - Deterministic background color from name hash (cycle through: bg-blue-500, bg-purple-500, bg-pink-500, bg-teal-500, bg-amber-500, bg-cyan-500)
         - Render as div with rounded-full, flex center, white bold text, font size proportional to container size
       - If `onUpload` prop provided: wrap in a label/input[type=file] that triggers on click
         - Hidden file input, accepts "image/jpeg,image/png,image/webp"
         - On file select, call onUpload(file)
         - Show a small camera/edit icon overlay on hover (absolute positioned, bottom-right)

    3. Create `frontend/src/pages/Profile.tsx`:
       - Use `useEffect` to fetch profile on mount via `fetchProfile()`
       - Loading state: show a simple loading spinner or skeleton
       - Error state: show error message with retry button

       **Hero section** (identity-focused per CONTEXT.md):
       - Dark background card (bg-slate-800 rounded-lg p-8)
       - Left side: Avatar component (size 80px) with onUpload handler
       - Right side: User name (text-3xl font-bold text-white) and email (text-slate-400)
       - Below name/email: XP and gems totals row
         - Reuse XpIcon and GemIcon from `../components/icons/`
         - XP: cyan icon + cyan bold number + "XP" label
         - Gems: purple icon + purple bold number + "Gems" label
         - Format numbers with toLocaleString()

       **Stats section:**
       - Separate card below hero (bg-slate-800 rounded-lg p-8)
       - "Statistics" heading (text-2xl font-bold text-white mb-6)

       **Empty state** (gamesPlayed === 0):
       - Centered text: "No games played yet!" (text-slate-400 text-lg)
       - Subtext: "Play your first game to start tracking your stats." (text-slate-500)
       - CTA button: "Play Your First Game" - navigates to /play
       - Styled as teal button matching existing game buttons

       **Stats list** (gamesPlayed > 0):
       - Simple vertical list with label: value pairs (per CONTEXT.md: NOT stat cards)
       - Each row: flex justify-between, py-3, border-b border-slate-700 (except last)
       - Three stats only:
         1. "Games Played" -> gamesPlayed (number)
         2. "Best Score" -> bestScore (formatted with toLocaleString())
         3. "Overall Accuracy" -> overallAccuracy + "%" (whole number)

       **Avatar upload handler:**
       - On file select from Avatar component, call `uploadAvatar(file)`
       - On success, update the local state to show the new avatar immediately
       - On error, show a toast or inline error message

       **Page wrapper:**
       - Include Header component at top
       - Main content: max-w-4xl mx-auto p-6
       - Dark gradient background matching the game aesthetic (bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 min-h-screen)
  </action>
  <verify>
    `cd frontend && npx tsc --noEmit` compiles without errors.
  </verify>
  <done>
    Profile page renders hero section with avatar + name + XP/gems totals, stats list with 3 stats, empty state for new users, and avatar upload capability.
  </done>
</task>

<task type="auto">
  <name>Task 2: Header hamburger menu and route registration</name>
  <files>
    frontend/src/components/layout/Header.tsx
    frontend/src/App.tsx
  </files>
  <action>
    1. Update `frontend/src/components/layout/Header.tsx`:
       - Add hamburger menu button (three horizontal lines icon) visible on all screen sizes
       - Position: right side of header, before the existing user name / logout text
       - On click: toggle a dropdown menu panel
       - Dropdown menu items:
         - "Profile" - Link to /profile (use react-router-dom Link or navigate)
         - "Log out" - calls existing handleLogout (move from inline to menu)
       - Close menu when clicking outside (useEffect with document click listener) or when a menu item is clicked
       - Hamburger icon: three horizontal bars SVG (standard hamburger pattern):
         ```
         <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
           <path d="M4 6h16M4 12h16M4 18h16" />
         </svg>
         ```
       - Menu panel styling:
         - Absolute positioned below the header
         - bg-white rounded-lg shadow-lg border border-gray-200
         - py-2, each item px-4 py-2 hover:bg-gray-100
       - Only show hamburger menu when user is authenticated
       - Remove the inline "Log out" text button (it moves into the hamburger menu)
       - Keep the user name display on sm+ screens

    2. Update `frontend/src/App.tsx`:
       - Import the Profile page: `import { Profile } from './pages/Profile';`
       - Add route inside the ProtectedRoute group: `<Route path="/profile" element={<Profile />} />`
  </action>
  <verify>
    1. `cd frontend && npx tsc --noEmit` compiles without errors
    2. `cd frontend && npm run build` builds without errors
    3. Navigate to /profile in browser - profile page renders
    4. Click hamburger menu in header - shows Profile and Log out options
    5. Click Profile menu item - navigates to /profile
    6. Click Log out menu item - logs out and redirects to /login
  </verify>
  <done>
    Header has hamburger menu with Profile and Log out items. Profile page route registered. Clicking Profile navigates to /profile. Menu closes on item click or outside click.
  </done>
</task>

</tasks>

<verification>
1. Frontend compiles: `cd frontend && npx tsc --noEmit`
2. Frontend builds: `cd frontend && npm run build`
3. Profile page accessible at /profile (requires authentication)
4. Profile shows hero section with avatar, name, email, XP total, gems total
5. Profile shows stats: games played, best score, overall accuracy %
6. New user (0 games) sees encouraging empty state with CTA button
7. Avatar shows initials when no image uploaded (colored circle)
8. Avatar upload works (select file, uploads, shows new image)
9. Hamburger menu visible in header when logged in
10. Hamburger menu has Profile and Log out items
11. Navigation to /profile works from hamburger menu
</verification>

<success_criteria>
- Profile page has hero section (identity-focused: name + avatar, not currency-focused)
- XP displayed in cyan with XpIcon, gems in purple with GemIcon
- Stats are simple vertical list (not stat cards): games played, best score, accuracy %
- Empty state (0 games) shows encouraging message + "Play Your First Game" CTA
- Avatar shows initials fallback with deterministic color from name hash
- Avatar upload accepts JPEG/PNG/WebP, shows new image on success
- Hamburger menu in header provides Profile and Log out navigation
- All routes protected (redirect to login if not authenticated)
</success_criteria>

<output>
After completion, create `.planning/phases/05-progression-profile/05-04-SUMMARY.md`
</output>
