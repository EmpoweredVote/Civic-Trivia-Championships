---
phase: 05-progression-profile
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - frontend/src/features/game/components/ResultsScreen.tsx
  - frontend/src/pages/Game.tsx
  - frontend/src/features/game/hooks/useGameState.ts
  - frontend/src/types/game.ts
  - frontend/src/components/icons/XpIcon.tsx
  - frontend/src/components/icons/GemIcon.tsx
autonomous: true

must_haves:
  truths:
    - "Results screen shows XP earned with count-up animation for logged-in users"
    - "Results screen shows gems earned with count-up animation for logged-in users"
    - "XP/gems hidden for anonymous users"
    - "Perfect game (10/10) applies golden treatment to XP/gems display"
  artifacts:
    - path: "frontend/src/features/game/components/ResultsScreen.tsx"
      provides: "XP and gems display with spring animations"
      contains: "progression"
    - path: "frontend/src/components/icons/XpIcon.tsx"
      provides: "Custom SVG icon for XP (cyan/blue family)"
      exports: ["XpIcon"]
    - path: "frontend/src/components/icons/GemIcon.tsx"
      provides: "Custom SVG icon for gems (purple/amethyst family)"
      exports: ["GemIcon"]
  key_links:
    - from: "frontend/src/pages/Game.tsx"
      to: "frontend/src/features/game/components/ResultsScreen.tsx"
      via: "progression prop passed from game result"
      pattern: "progression"
    - from: "frontend/src/features/game/components/ResultsScreen.tsx"
      to: "framer-motion"
      via: "useMotionValue + animate for count-up"
      pattern: "useMotionValue|animate"
---

<objective>
Display XP and gems earned on the results screen with count-up animations matching the existing score animation style.

Purpose: Users need visible feedback on progression rewards after each game (PROG-03). This makes the game feel rewarding and motivates replaying.

Output: Results screen shows "+57 XP" and "+14 gems" with spring-animated count-up, custom SVG icons, perfect game golden treatment, hidden for anonymous users.
</objective>

<execution_context>
@C:\Users\Chris\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Chris\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@C:\Project Test\.planning\PROJECT.md
@C:\Project Test\.planning\ROADMAP.md
@C:\Project Test\.planning\phases\05-progression-profile\05-CONTEXT.md
@C:\Project Test\.planning\phases\05-progression-profile\05-RESEARCH.md
@C:\Project Test\.planning\phases\05-progression-profile\05-01-SUMMARY.md

Key existing files:
@C:\Project Test\frontend\src\features\game\components\ResultsScreen.tsx
@C:\Project Test\frontend\src\pages\Game.tsx
@C:\Project Test\frontend\src\features\game\hooks\useGameState.ts
@C:\Project Test\frontend\src\types\game.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: SVG icons and type updates</name>
  <files>
    frontend/src/components/icons/XpIcon.tsx
    frontend/src/components/icons/GemIcon.tsx
    frontend/src/types/game.ts
  </files>
  <action>
    1. Create `frontend/src/components/icons/XpIcon.tsx`:
       - Simple SVG icon component for XP in the cyan/blue family
       - Accept className prop for sizing (e.g., "w-6 h-6")
       - Design: a star or lightning bolt shape â€” something that reads as "experience points"
       - Use `fill="currentColor"` so the color is controlled by parent text-cyan-400 class
       - Example: a 4-pointed star or upward arrow with sparkle

    2. Create `frontend/src/components/icons/GemIcon.tsx`:
       - Simple SVG icon component for gems in the purple/amethyst family
       - Accept className prop for sizing
       - Design: a diamond/gem shape (hexagonal or classic diamond silhouette)
       - Use `fill="currentColor"` so color is controlled by parent text-purple-400 class

    3. Update `frontend/src/types/game.ts`:
       - Add a `Progression` type: `{ xpEarned: number; gemsEarned: number }`
       - Add `progression?: Progression | null` to the `GameResult` type
       - This allows the results screen to receive progression data from the API

    Both icon components should be simple functional components like:
    ```tsx
    export function XpIcon({ className = 'w-6 h-6' }: { className?: string }) {
      return (
        <svg className={className} viewBox="0 0 24 24" fill="currentColor">
          {/* SVG path */}
        </svg>
      );
    }
    ```
  </action>
  <verify>
    `cd frontend && npx tsc --noEmit` compiles without errors.
  </verify>
  <done>
    XP and gem SVG icons exist. GameResult type includes optional progression field.
  </done>
</task>

<task type="auto">
  <name>Task 2: Results screen XP/gems display with animations</name>
  <files>
    frontend/src/features/game/components/ResultsScreen.tsx
    frontend/src/pages/Game.tsx
    frontend/src/features/game/hooks/useGameState.ts
  </files>
  <action>
    1. Update `frontend/src/features/game/hooks/useGameState.ts`:
       - When constructing `gameResult` in the `complete` phase block, include progression data
       - The progression data should come from the results API response. Currently results are computed client-side from state.answers. We need to fetch server results to get the progression field.
       - Add a `progression` state field (useState) to store progression from the server
       - When the game transitions to 'complete' phase, fetch results from the server: `GET /api/game/results/${sessionIdRef.current}`
       - Extract `progression` from the server response and store it
       - Include it in the gameResult object
       - If the user is not authenticated (check useAuthStore.getState().isAuthenticated), skip the fetch and set progression to null

    2. Update `frontend/src/pages/Game.tsx`:
       - No changes needed if gameResult already includes progression (it will from the hook update)
       - The ResultsScreen component will receive result which now has progression

    3. Update `frontend/src/features/game/components/ResultsScreen.tsx`:
       - Import XpIcon and GemIcon from `../../../components/icons/`
       - Add XP and gems count-up animation using the EXACT same pattern as the existing score animation:
         - Create `xpMotionValue = useMotionValue(0)` and `gemsMotionValue = useMotionValue(0)`
         - Animate with same spring config: `{ type: 'spring', stiffness: 100, damping: 20, mass: 0.5, duration: 1.5 }`
         - Subscribe to changes with `motionValue.on('change', ...)` and `Math.round()`
         - Return cleanup functions that stop controls and unsubscribe
       - Only animate/render if `result.progression` is truthy (hides for anonymous users)
       - Display in a row below the existing score, INSIDE the same score display container:
         - Position: after the "Total Points" label, before the base+speed breakdown
         - Layout: `flex items-center justify-center gap-8 mt-4`
         - XP: `<XpIcon className="w-6 h-6 text-cyan-400" />` + `<span className="text-2xl font-bold text-cyan-400">+{displayXP}</span>`
         - Gems: `<GemIcon className="w-6 h-6 text-purple-400" />` + `<span className="text-2xl font-bold text-purple-400">+{displayGems}</span>`
       - Perfect game golden treatment: when isPerfectGame is true, change XP text to text-yellow-400 and gems text to text-yellow-400 (matching existing score golden treatment)
       - Add motion.div wrapper with `initial={{ opacity: 0, y: 20 }}` and `animate={{ opacity: 1, y: 0 }}` with delay: 0.15 (between score and breakdown)
       - Icons + numbers only, no "Rewards Earned" label (per CONTEXT.md decision)
       - Show "+{value}" format (e.g., "+57", "+14") not just the number
  </action>
  <verify>
    1. `cd frontend && npx tsc --noEmit` compiles without errors
    2. `cd frontend && npm run build` builds without errors
    3. Manual test: Start a game as logged-in user, complete it, verify XP and gems appear on results screen with count-up animation
    4. Manual test: Start a game without being logged in (if possible), verify no XP/gems shown
  </verify>
  <done>
    Results screen displays "+{N} XP" and "+{N} gems" with animated count-up for authenticated users. Hidden for anonymous. Perfect game gets golden text on rewards. Icons are custom SVGs in cyan and purple.
  </done>
</task>

</tasks>

<verification>
1. Frontend TypeScript compiles: `cd frontend && npx tsc --noEmit`
2. Frontend builds: `cd frontend && npm run build`
3. XP/gems visible on results screen for authenticated user after game completion
4. XP/gems hidden for anonymous user
5. Count-up animation matches existing score animation style (spring physics)
6. Perfect game (10/10) shows golden XP/gems text
7. Icons render as SVGs in correct colors (cyan for XP, purple for gems)
</verification>

<success_criteria>
- Authenticated user sees "+{N} XP" and "+{N} gems" on results screen after game
- Values animate from 0 with spring physics matching existing score counter
- Perfect game applies golden treatment (text-yellow-400) to XP and gems
- Anonymous users see no XP/gems display (no errors, just hidden)
- Custom SVG icons for XP (cyan) and gems (purple) render correctly
- No "Rewards Earned" label - icons + numbers only
</success_criteria>

<output>
After completion, create `.planning/phases/05-progression-profile/05-02-SUMMARY.md`
</output>
