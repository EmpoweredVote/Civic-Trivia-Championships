---
phase: 18-foundation-admin-auth-telemetry
plan: 02
type: execute
wave: 2
depends_on: ["18-01"]
files_modified:
  - frontend/src/types/auth.ts
  - frontend/src/components/ProtectedRoute.tsx
  - frontend/src/App.tsx
  - frontend/src/components/layout/Header.tsx
  - frontend/src/pages/Admin.tsx
  - frontend/src/pages/Forbidden.tsx
  - frontend/src/pages/admin/AdminLayout.tsx
  - frontend/src/pages/admin/AdminDashboard.tsx
autonomous: true

must_haves:
  truths:
    - "A non-admin user navigating to /admin sees a friendly 403 page with a link home"
    - "An admin user navigating to /admin sees the admin shell with red theme"
    - "No nav link to /admin exists anywhere in the main app -- admins access by typing URL"
    - "Admin users see a subtle 'Admin' pill indicator in the Header"
    - "The admin shell has a sidebar + header layout with red color scheme"
  artifacts:
    - path: "frontend/src/types/auth.ts"
      provides: "User type with isAdmin field"
      contains: "isAdmin"
    - path: "frontend/src/pages/Forbidden.tsx"
      provides: "403 Forbidden page component"
      contains: "403"
    - path: "frontend/src/pages/admin/AdminLayout.tsx"
      provides: "Admin shell with sidebar + header, red theme"
      contains: "bg-red"
    - path: "frontend/src/pages/admin/AdminDashboard.tsx"
      provides: "Welcome placeholder landing page"
      contains: "Welcome"
    - path: "frontend/src/App.tsx"
      provides: "Admin route guard using AdminGuard"
      contains: "AdminGuard"
    - path: "frontend/src/components/layout/Header.tsx"
      provides: "Admin pill indicator for admin users, no Review link"
      contains: "Admin"
  key_links:
    - from: "frontend/src/App.tsx"
      to: "frontend/src/pages/Forbidden.tsx"
      via: "AdminGuard renders Forbidden for non-admin users"
      pattern: "Forbidden|AdminGuard"
    - from: "frontend/src/App.tsx"
      to: "frontend/src/pages/admin/AdminLayout.tsx"
      via: "Admin routes render inside AdminLayout"
      pattern: "AdminLayout"
    - from: "frontend/src/components/layout/Header.tsx"
      to: "frontend/src/store/authStore.ts"
      via: "Reads user.isAdmin to show Admin pill"
      pattern: "isAdmin"
---

<objective>
Build the frontend admin route guard, 403 page, admin shell layout, and admin indicator. Non-admins see a friendly 403 page. Admins see a red-themed admin shell with sidebar + header.

Purpose: Completes the admin access control loop (backend middleware from Plan 01 + frontend guard). Creates the admin shell that Phase 20 fills with real content.
Output: Admin route guard, 403 page, admin shell with red theme, admin indicator pill in header.
</objective>

<execution_context>
@C:\Users\Chris\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Chris\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/18-foundation-admin-auth-telemetry/18-CONTEXT.md
@.planning/phases/18-foundation-admin-auth-telemetry/18-RESEARCH.md
@.planning/phases/18-foundation-admin-auth-telemetry/18-01-SUMMARY.md

@frontend/src/App.tsx
@frontend/src/types/auth.ts
@frontend/src/store/authStore.ts
@frontend/src/components/ProtectedRoute.tsx
@frontend/src/components/layout/Header.tsx
@frontend/src/pages/Admin.tsx
@frontend/src/components/AuthInitializer.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update User type, create Forbidden page and AdminGuard, rewire routing</name>
  <files>
    frontend/src/types/auth.ts
    frontend/src/pages/Forbidden.tsx
    frontend/src/App.tsx
    frontend/src/components/ProtectedRoute.tsx
  </files>
  <action>
  1. **Update User type (`frontend/src/types/auth.ts`):**
     Add `isAdmin?: boolean` to the `User` interface. Optional because existing tokens without isAdmin should not break.

  2. **Create 403 Forbidden page (`frontend/src/pages/Forbidden.tsx`):**
     A friendly, non-intimidating page. Per CONTEXT.md decisions:
     - Tone: "This area is for admins. If you think you should have access, contact us."
     - Include a link back to home (/)
     - Use the existing app styling (Tailwind, gray-50 bg, centered content)
     - Show a shield or lock icon (inline SVG, no new dependency)
     - This is NOT a redirect -- it's a rendered 403 page component

  3. **Create AdminGuard component** (can be inline in App.tsx or a small component file):
     ```tsx
     function AdminGuard() {
       const { isAuthenticated, user, isLoading } = useAuthStore();
       if (isLoading) return null;
       if (!isAuthenticated) return <Navigate to="/login" replace />;
       if (!user?.isAdmin) return <Forbidden />;
       return <Outlet />;
     }
     ```
     Place this in App.tsx as a local component (it's small enough not to need its own file).

  4. **Update App.tsx routing:**
     - Remove the current `/admin` route from the ProtectedRoute group
     - Add a new route group for admin routes using AdminGuard:
       ```tsx
       <Route element={<AdminGuard />}>
         <Route path="/admin" element={<AdminLayout />}>
           <Route index element={<AdminDashboard />} />
           {/* Future admin routes will be added here in Phase 20 */}
         </Route>
       </Route>
       ```
     - Import AdminLayout, AdminDashboard, Forbidden, and the auth store
     - Keep the existing ProtectedRoute for /profile (no change there)

  5. **Leave ProtectedRoute unchanged** -- it still protects /profile. AdminGuard is separate.
  </action>
  <verify>
    - TypeScript compiles: `cd frontend && npx tsc --noEmit`
    - Forbidden.tsx exists and exports a component
    - App.tsx has AdminGuard with isAdmin check
    - App.tsx routes /admin through AdminGuard -> AdminLayout
    - /profile still uses ProtectedRoute (no regression)
  </verify>
  <done>
    - User type includes isAdmin?: boolean
    - Non-admin authenticated users see 403 page at /admin
    - Unauthenticated users at /admin are redirected to /login
    - Admin users at /admin see AdminLayout with AdminDashboard
    - /profile route still works for any authenticated user
  </done>
</task>

<task type="auto">
  <name>Task 2: Create admin shell layout, dashboard placeholder, and update Header</name>
  <files>
    frontend/src/pages/admin/AdminLayout.tsx
    frontend/src/pages/admin/AdminDashboard.tsx
    frontend/src/pages/Admin.tsx
    frontend/src/components/layout/Header.tsx
  </files>
  <action>
  1. **Create AdminLayout (`frontend/src/pages/admin/AdminLayout.tsx`):**
     Per CONTEXT.md: sidebar + header layout with red theme, distinct from the player experience.
     - Left sidebar: fixed width (~64px collapsed or ~240px expanded), red-themed (bg-red-800 or bg-red-900)
     - Sidebar navigation links (placeholder for Phase 20):
       - "Dashboard" (links to /admin, active by default)
       - "Questions" (placeholder, links to /admin/questions -- will be built in Phase 20)
       - "Collections" (placeholder, links to /admin/collections -- will be built in Phase 20)
     - Each nav link: white text, hover state (bg-red-700), active state indicator
     - Top header bar: white or light background with "Admin" title in red, user name on right
     - Main content area: renders `<Outlet />` from react-router-dom
     - Responsive: on mobile, sidebar collapses to a hamburger menu
     - Use existing Tailwind classes -- no new dependencies

  2. **Create AdminDashboard (`frontend/src/pages/admin/AdminDashboard.tsx`):**
     Per CONTEXT.md: welcome + placeholder cards for upcoming features.
     - "Welcome, Admin" heading (or "Welcome, {user.name}" from auth store)
     - 3 placeholder cards in a responsive grid:
       - "Question Explorer" -- "Browse, filter, and inspect questions" (Coming in Phase 20)
       - "Collection Health" -- "Monitor question counts and quality" (Coming in Phase 20)
       - "Content Generation" -- "AI-powered question pipeline" (Coming in Phase 21)
     - Cards use a subtle red accent (red-50 bg, red-600 icon/border) to maintain admin theme
     - Each card has a relevant icon (inline SVG), title, description, and "Coming soon" badge

  3. **Remove old Admin.tsx content or repurpose:**
     The existing `frontend/src/pages/Admin.tsx` is the v1.2 expiration review page. This content will eventually move to the admin shell in Phase 20. For now:
     - Keep the file but update it to redirect to the new admin dashboard, OR
     - If the old admin page is accessed at /admin, the AdminLayout now handles routing, so the old Admin.tsx can be deleted or moved to `frontend/src/features/admin/pages/ContentReview.tsx` for later reuse in Phase 20.
     - Simplest approach: delete the old Admin.tsx import from App.tsx (the new AdminDashboard replaces it). Keep the old Admin.tsx file renamed to `ContentReview.tsx` in the admin features folder for Phase 20.

  4. **Update Header (`frontend/src/components/layout/Header.tsx`):**
     Per CONTEXT.md decisions:
     - **Remove the "Review" menu item** from the dropdown menu (admin is hidden, no nav link to /admin)
     - **Add subtle "Admin" pill** for admin users: a small red badge/pill next to the user name that says "Admin" and links to /admin. Only visible when `user?.isAdmin` is true.
       - Style: `text-xs font-medium bg-red-100 text-red-700 px-2 py-0.5 rounded-full`
       - Clickable: links to /admin
       - Position: next to user name in header, before the hamburger menu
     - Keep all other Header functionality unchanged (logout, profile link, etc.)
  </action>
  <verify>
    - TypeScript compiles: `cd frontend && npx tsc --noEmit`
    - AdminLayout.tsx exists with red-themed sidebar
    - AdminDashboard.tsx exists with welcome message and placeholder cards
    - Header.tsx shows Admin pill only when user.isAdmin is true
    - Header.tsx does NOT have a "Review" link in the dropdown menu
    - `cd frontend && npm run build` succeeds
  </verify>
  <done>
    - Admin shell has sidebar (red bg) + header + main content area
    - Sidebar has Dashboard, Questions, Collections nav links (Questions/Collections are placeholders)
    - AdminDashboard shows welcome message and 3 placeholder feature cards
    - Header shows "Admin" pill for admin users that links to /admin
    - No "Review" or "Admin" link in the hamburger dropdown menu for any user
    - Old Admin.tsx content preserved as ContentReview for Phase 20 reuse
    - Frontend builds successfully
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `cd frontend && npx tsc --noEmit`
2. Frontend builds: `cd frontend && npm run build`
3. Non-admin user at /admin sees friendly 403 page
4. Admin user at /admin sees red-themed admin shell with sidebar
5. Admin dashboard shows welcome + 3 placeholder cards
6. Header shows "Admin" pill only for admin users
7. No navigation link to /admin in main app UI
8. /profile route still works for any authenticated user
</verification>

<success_criteria>
- Non-admin users see 403 page at /admin (not a redirect, a rendered page)
- Admin users see admin shell with red sidebar + header
- Admin dashboard has welcome message and placeholder cards
- Header has subtle Admin pill for admin users linking to /admin
- Admin section is hidden (no menu links to /admin in main nav)
- Frontend builds and compiles cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/18-foundation-admin-auth-telemetry/18-02-SUMMARY.md`
</output>
