---
phase: 15-collection-picker-ui
plan: 03
type: execute
wave: 2
depends_on: ["15-01", "15-02"]
files_modified:
  - frontend/src/pages/Dashboard.tsx
  - frontend/src/features/game/hooks/useGameState.ts
  - frontend/src/pages/Game.tsx
  - frontend/src/features/game/components/GameScreen.tsx
  - frontend/src/features/game/components/ResultsScreen.tsx
autonomous: true

must_haves:
  truths:
    - "Player sees collection cards on the dashboard before starting a game"
    - "Federal Civics is preselected as the default collection"
    - "Start Game button text reflects selected collection name"
    - "Selecting a collection and clicking Start loads questions from that collection"
    - "Collection name appears in the game header during gameplay"
    - "Collection name appears on the results screen after game completion"
  artifacts:
    - path: "frontend/src/pages/Dashboard.tsx"
      provides: "Collection picker integration with start game flow"
      contains: "CollectionPicker"
    - path: "frontend/src/features/game/hooks/useGameState.ts"
      provides: "startGame accepts optional collectionId"
      contains: "startGame.*collectionId"
    - path: "frontend/src/features/game/components/GameScreen.tsx"
      provides: "Collection name badge in game header"
      contains: "collectionName"
    - path: "frontend/src/features/game/components/ResultsScreen.tsx"
      provides: "Collection name below Game Complete heading"
      contains: "collectionName"
  key_links:
    - from: "frontend/src/pages/Dashboard.tsx"
      to: "/play"
      via: "navigate with collectionId in router state"
      pattern: "navigate.*play.*collectionId"
    - from: "frontend/src/pages/Game.tsx"
      to: "frontend/src/features/game/hooks/useGameState.ts"
      via: "startGame(collectionId) from router state"
      pattern: "startGame.*collectionId"
    - from: "frontend/src/features/game/hooks/useGameState.ts"
      to: "frontend/src/services/gameService.ts"
      via: "createGameSession(collectionId)"
      pattern: "createGameSession.*collectionId"
---

<objective>
Wire the collection picker into the Dashboard, pass the selected collectionId through to the game, and display the collection name in the game header and results screen.

Purpose: This is the integration plan that connects all the pieces: the backend endpoint (Plan 01), the picker components (Plan 02), the existing Dashboard, and the game flow. After this plan, the full user journey works: see picker -> select collection -> start game -> see collection name during play -> see it on results.

Output: Updated Dashboard with collection picker, updated game flow passing collectionId, and collection name displayed in game header and results.
</objective>

<execution_context>
@C:\Users\Chris\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Chris\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-collection-picker-ui/15-CONTEXT.md
@.planning/phases/15-collection-picker-ui/15-RESEARCH.md
@.planning/phases/15-collection-picker-ui/15-01-SUMMARY.md
@.planning/phases/15-collection-picker-ui/15-02-SUMMARY.md
@frontend/src/pages/Dashboard.tsx
@frontend/src/pages/Game.tsx
@frontend/src/features/game/hooks/useGameState.ts
@frontend/src/features/game/components/GameScreen.tsx
@frontend/src/features/game/components/ResultsScreen.tsx
@frontend/src/services/gameService.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Integrate CollectionPicker into Dashboard and wire game start</name>
  <files>
    frontend/src/pages/Dashboard.tsx
    frontend/src/features/game/hooks/useGameState.ts
    frontend/src/pages/Game.tsx
  </files>
  <action>
**1. Update `Dashboard.tsx`:**

Import `useCollections` from `../features/collections/hooks/useCollections` and `CollectionPicker` from `../features/collections/components/CollectionPicker`.

Call `useCollections()` at the top of the component to get `{ collections, selectedId, selectedCollection, loading, select }`.

Restructure the dashboard content:
- Keep the welcome heading at top
- Move the Start Game button to sit above the collection picker
- Change button text from "Quick Play" to dynamic: `selectedCollection ? \`Play \${selectedCollection.name}\` : 'Quick Play'`
- Update button onClick: `navigate('/play', { state: { collectionId: selectedId } })` — passes the selected collectionId via React Router location state
- Below the button, add `<CollectionPicker collections={collections} selectedId={selectedId} loading={loading} onSelect={select} />`
- Keep the sign-in nudge below the picker
- Update the subtitle below the button: remove "10 questions. Test your civic knowledge." or keep it — either is fine

The layout should be: heading -> "Play [Collection]" button (centered, prominent) -> collection cards below -> sign-in nudge at bottom.

**2. Update `useGameState.ts`:**

Change `startGame` signature to accept an optional `collectionId`:

```typescript
const startGame = async (collectionId?: number) => {
  try {
    const { sessionId, questions, degraded, collectionName, collectionSlug } = await createGameSession(collectionId);
    ...
  }
};
```

Update the `UseGameStateReturn` interface:
```typescript
startGame: (collectionId?: number) => Promise<void>;
```

`createGameSession` already accepts `collectionId?: number` (verified in gameService.ts), so this just passes it through.

**3. Update `Game.tsx`:**

Import `useLocation` from `react-router-dom`.

Read collectionId from router state:
```typescript
const location = useLocation();
const collectionId = (location.state as { collectionId?: number } | null)?.collectionId;
```

Pass collectionId to `startGame` in two places:
- The initial idle screen's start button (in GameScreen) — but GameScreen receives `startGame` as a prop, so update the call there. Actually, the cleanest approach: auto-start the game when arriving from Dashboard with a collectionId. Add a `useEffect`:

```typescript
useEffect(() => {
  if (collectionId !== undefined && state.phase === 'idle') {
    startGame(collectionId);
  }
}, []);
```

This auto-starts when navigating from Dashboard (collectionId present). If the user navigates to /play directly (no collectionId), they see the idle screen with "Quick Play" as before.

Also update `handlePlayAgain`:
```typescript
const handlePlayAgain = () => {
  startGame(collectionId); // Replay same collection
};
```

And pass `startGame` through to GameScreen — since GameScreen calls `startGame()` in the idle phase for the "Quick Play" button, update that call to use `startGame(collectionId)`. The simplest approach: wrap startGame before passing to GameScreen:
```typescript
const handleStartGame = () => startGame(collectionId);
```
Pass `handleStartGame` as the `startGame` prop to GameScreen.
  </action>
  <verify>
TypeScript compiles: `cd frontend && npx tsc --noEmit`. Dashboard renders with collection picker. Navigating to /play from Dashboard passes collectionId in router state.
  </verify>
  <done>
Dashboard shows collection picker with dynamic "Play [Collection Name]" button. Clicking start navigates to /play with collectionId. Game auto-starts with the selected collection. Play Again replays the same collection.
  </done>
</task>

<task type="auto">
  <name>Task 2: Display collection name in game header and results screen</name>
  <files>
    frontend/src/features/game/components/GameScreen.tsx
    frontend/src/features/game/components/ResultsScreen.tsx
  </files>
  <action>
**1. Update `GameScreen.tsx`:**

The component receives `state` which is `GameState`. `GameState` already has `collectionName: string | null` (populated by SESSION_CREATED action in the reducer).

Find the top HUD area of the game screen (the area with question counter, score, timer). Add a small collection name badge/label:

```tsx
{state.collectionName && (
  <div className="text-xs text-slate-500 font-medium tracking-wide uppercase">
    {state.collectionName}
  </div>
)}
```

Place this near the top of the game UI, above or near the question counter. It should be subtle — not competing with the question text. Position it as a small label in the header area.

Only show when `state.phase !== 'idle'` (don't show on the start screen).

**2. Update `ResultsScreen.tsx`:**

The component receives `result: GameResult`. However, `GameResult` (defined in `types/game.ts`) does NOT include `collectionName`. There are two approaches:

**Approach A (recommended):** Add a `collectionName` prop to ResultsScreen. In `Game.tsx`, pass `state.collectionName` as a new prop:
```tsx
<ResultsScreen
  result={gameResult}
  questions={state.questions}
  collectionName={state.collectionName}
  onPlayAgain={handlePlayAgain}
  onHome={handleHome}
/>
```

In ResultsScreen, add `collectionName?: string | null` to the props interface and display it below the "Game Complete!" heading:
```tsx
{collectionName && (
  <div className="text-slate-400 text-sm mb-4">{collectionName}</div>
)}
```

This keeps it simple — no extra fetch, no type changes to GameResult.

Update `Game.tsx` to pass the new `collectionName` prop when rendering ResultsScreen.
  </action>
  <verify>
TypeScript compiles: `cd frontend && npx tsc --noEmit`. During gameplay, collection name appears as a subtle badge in the game header. On the results screen, collection name appears below "Game Complete!".
  </verify>
  <done>
Collection name displays in game header during play (subtle badge) and on results screen below the completion heading. Both read from GameState.collectionName which is populated by the session creation response.
  </done>
</task>

</tasks>

<verification>
- `cd frontend && npx tsc --noEmit` passes with no errors
- Dashboard shows collection cards with Federal Civics preselected
- Button text reads "Play Federal Civics" (or whichever collection is selected)
- Clicking "Play Federal Civics" navigates to /play and auto-starts the game
- Game header shows "Federal Civics" badge during gameplay
- Results screen shows "Federal Civics" below "Game Complete!"
- Play Again replays the same collection
- Direct navigation to /play (no router state) shows idle screen with "Quick Play" (backward compat)
</verification>

<success_criteria>
The complete collection picker flow works end-to-end: browse collections on dashboard, select one, start game with that collection, see collection name during play and on results.
</success_criteria>

<output>
After completion, create `.planning/phases/15-collection-picker-ui/15-03-SUMMARY.md`
</output>
