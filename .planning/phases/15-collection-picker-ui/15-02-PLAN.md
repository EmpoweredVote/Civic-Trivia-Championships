---
phase: 15-collection-picker-ui
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/features/collections/types.ts
  - frontend/src/features/collections/hooks/useCollections.ts
  - frontend/src/features/collections/components/CollectionCard.tsx
  - frontend/src/features/collections/components/CollectionCardSkeleton.tsx
  - frontend/src/features/collections/components/CollectionPicker.tsx
autonomous: true

must_haves:
  truths:
    - "CollectionPicker renders collection cards from API data"
    - "Clicking a card selects it visually without starting the game"
    - "Skeleton placeholders show during loading"
    - "Cards stack vertically on mobile, horizontal row on desktop"
    - "Selected card has elevated shadow/scale and colored border"
    - "Last-played collection is remembered in localStorage"
  artifacts:
    - path: "frontend/src/features/collections/types.ts"
      provides: "CollectionSummary interface"
      contains: "CollectionSummary"
    - path: "frontend/src/features/collections/hooks/useCollections.ts"
      provides: "useCollections hook with fetch, selection, localStorage"
      exports: ["useCollections"]
    - path: "frontend/src/features/collections/components/CollectionCard.tsx"
      provides: "Individual collection card component"
      exports: ["CollectionCard"]
    - path: "frontend/src/features/collections/components/CollectionCardSkeleton.tsx"
      provides: "Skeleton loading placeholder"
      exports: ["CollectionCardSkeleton"]
    - path: "frontend/src/features/collections/components/CollectionPicker.tsx"
      provides: "Main picker section composing cards and skeletons"
      exports: ["CollectionPicker"]
  key_links:
    - from: "frontend/src/features/collections/hooks/useCollections.ts"
      to: "/api/game/collections"
      via: "apiRequest fetch call"
      pattern: "apiRequest.*collections"
    - from: "frontend/src/features/collections/components/CollectionPicker.tsx"
      to: "frontend/src/features/collections/hooks/useCollections.ts"
      via: "hook consumption"
      pattern: "useCollections"
---

<objective>
Build the self-contained collection picker feature: types, data hook, and UI components.

Purpose: Create all the building blocks for the collection picker — the type definitions, the data-fetching hook with localStorage persistence, and the card components (active, skeleton). These components are self-contained and can be built without the backend endpoint being live (the hook handles loading/error states).

Output: A complete `features/collections/` folder with types, hook, and three components ready for integration into the Dashboard.
</objective>

<execution_context>
@C:\Users\Chris\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Chris\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/15-collection-picker-ui/15-RESEARCH.md
@frontend/src/services/api.ts
@frontend/src/features/game/hooks/useGameState.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create collection types and useCollections hook</name>
  <files>
    frontend/src/features/collections/types.ts
    frontend/src/features/collections/hooks/useCollections.ts
  </files>
  <action>
**1. Create `frontend/src/features/collections/types.ts`:**

```typescript
export interface CollectionSummary {
  id: number;
  name: string;
  slug: string;
  description: string;
  themeColor: string;        // 7-char hex e.g. '#1E3A8A'
  questionCount: number;
}
```

**2. Create `frontend/src/features/collections/hooks/useCollections.ts`:**

A custom hook that:
- Fetches collections from `/api/game/collections` using `apiRequest` from `../../../services/api`
- Manages `collections: CollectionSummary[]`, `selectedId: number | null`, and `loading: boolean` state
- On mount: reads `lastCollectionId` from localStorage, fetches collections, then sets selectedId to saved value (if valid and present in fetched list) or `collections[0]?.id` (lowest sortOrder = Federal Civics default)
- Exposes a `select(id: number)` function that updates selectedId and writes to localStorage key `lastCollectionId`
- Exposes a derived `selectedCollection` computed from `collections.find(c => c.id === selectedId)`
- Returns `{ collections, selectedId, selectedCollection, loading, select }`

Use `useState` and `useEffect` (not Zustand — this is page-local state per research guidance).

Handle error state gracefully: if fetch fails, set `collections` to empty array, `loading` to false. No error toast needed — the picker just won't show cards.

localStorage key: `'lastCollectionId'`. Store as string via `String(id)`, parse back via `parseInt(saved, 10)`.
  </action>
  <verify>
TypeScript compiles: `cd frontend && npx tsc --noEmit`. The hook file imports correctly from the api service.
  </verify>
  <done>
CollectionSummary type is defined. useCollections hook fetches data, manages selection with localStorage persistence, and defaults to first collection.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create CollectionCard, CollectionCardSkeleton, and CollectionPicker components</name>
  <files>
    frontend/src/features/collections/components/CollectionCard.tsx
    frontend/src/features/collections/components/CollectionCardSkeleton.tsx
    frontend/src/features/collections/components/CollectionPicker.tsx
  </files>
  <action>
**1. Create `CollectionCard.tsx`:**

Props: `{ collection: CollectionSummary; isSelected: boolean; onSelect: (id: number) => void }`

- Render as a `<button>` element (accessible, clickable)
- Colored header band: a `<div>` with `className="h-14 rounded-t-xl"` and `style={{ backgroundColor: collection.themeColor }}` (MUST use inline style — Tailwind JIT purges dynamic class strings)
- Card body below header: dark background (`bg-slate-800`), padding, collection name (white, semibold), description (slate-400, text-xs, `line-clamp-2`), question count (slate-500, text-xs)
- Selected state: `ring-2 ring-teal-400 shadow-xl scale-105` — visually elevated
- Unselected state: `opacity-80 hover:opacity-100 hover:scale-[1.02]` — slightly receded
- Add `aria-pressed={isSelected}` and descriptive `aria-label`
- Checkmark indicator on selected card: absolute positioned circle in top-right with SVG checkmark
- Card width: `w-full sm:w-48` (full-width on mobile, fixed on desktop), `flex-shrink-0`
- Rounded corners: `rounded-xl overflow-hidden`
- Smooth transition: `transition-all duration-200`
- `text-left` for button text alignment

**2. Create `CollectionCardSkeleton.tsx`:**

No props needed. Returns a skeleton card matching CollectionCard dimensions:
- Same `w-full sm:w-48 rounded-xl overflow-hidden` sizing
- Header band placeholder: `h-14 bg-slate-700 animate-pulse`
- Body with 3 placeholder lines: `bg-slate-700 animate-pulse rounded` at different widths (w-3/4, w-full, w-1/2)
- Spacing matches real card layout

**3. Create `CollectionPicker.tsx`:**

Props: `{ collections: CollectionSummary[]; selectedId: number | null; loading: boolean; onSelect: (id: number) => void }`

The CollectionPicker does NOT use the hook directly — it receives data as props (the Dashboard will own the hook). This makes the component pure and testable.

Layout:
- Section heading: "Choose Your Collection" in small caps or `text-sm font-semibold text-slate-500 uppercase tracking-wider mb-3`
- Flex container: `flex flex-col sm:flex-row gap-3 pb-2`
  - On mobile (`flex-col`): cards stack vertically, full-width
  - On desktop (`sm:flex-row`): cards in horizontal row
- Loading state: render 3 `CollectionCardSkeleton` components
- Loaded state: render `CollectionCard` for each collection
- If `collections` is empty and not loading: render nothing (don't show empty picker)
  </action>
  <verify>
TypeScript compiles: `cd frontend && npx tsc --noEmit`. All three components export correctly.
  </verify>
  <done>
Three components exist: CollectionCard with selected/unselected states and accessible markup, CollectionCardSkeleton with pulse animation, and CollectionPicker composing them with responsive layout. All use inline style for themeColor (not dynamic Tailwind classes).
  </done>
</task>

</tasks>

<verification>
- `cd frontend && npx tsc --noEmit` passes
- features/collections/ directory exists with types.ts, hooks/useCollections.ts, components/CollectionCard.tsx, CollectionCardSkeleton.tsx, CollectionPicker.tsx
- CollectionCard uses `style={{ backgroundColor: ... }}` not dynamic Tailwind class
- CollectionPicker renders skeletons during loading, cards when loaded
- useCollections reads/writes localStorage key 'lastCollectionId'
</verification>

<success_criteria>
All collection picker building blocks are created, typed, and ready for integration into the Dashboard page.
</success_criteria>

<output>
After completion, create `.planning/phases/15-collection-picker-ui/15-02-SUMMARY.md`
</output>
